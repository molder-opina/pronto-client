<!doctype html>
<html lang="es" style="color-scheme: dark;">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="csrf-token" content="{{ csrf_token() }}">
  <title>{{ restaurant_name|title }} · Staff</title>
  <link rel="stylesheet" href="{{ assets_css_employees }}/styles.css" />
  <link rel="icon" href="{{ restaurant_assets }}/branding/icon.png" type="image/png" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="{{ assets_css_employees }}/components/header-profile.css" />
  <link rel="stylesheet" href="{{ assets_css_employees }}/components/panel-upgrades.css" />
  <link rel="stylesheet" href="{{ assets_css_employees }}/components/toast.css" />
  <link rel="stylesheet" href="{{ assets_css_employees }}/components/loading.css" />
  <link rel="stylesheet" href="{{ assets_css_employees }}/components/empty-state.css" />
  <link rel="stylesheet" href="{{ assets_css_employees }}/components/cards.css" />
  <link rel="stylesheet" href="{{ assets_css_employees }}/dashboard.css" />
  <link rel="stylesheet" href="{{ assets_css_employees }}/waiter.css" />
  <link rel="stylesheet" href="{{ assets_css_employees }}/waiter-pos-modern.css" />
  <link rel="stylesheet" href="{{ assets_css_employees }}/reports.css" />
  <link rel="stylesheet" href="{{ assets_css_employees }}/tokens.css" />
  <link rel="stylesheet" href="{{ assets_css }}/notifications.css" />
  <style>
    :root {
      --primary-orange: #ff6b35;
      --primary-orange-dark: #e85a2b;
      --primary-orange-light: #fff5f2;
      --sidebar-bg: #0f172a;
      --sidebar-border: rgba(255, 255, 255, 0.08);
    }

    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family:
        'DM Sans',
        -apple-system,
        BlinkMacSystemFont,
        'Segoe UI',
        sans-serif;
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      min-height: 100vh;
      color: #1e293b;
    }

    .global-loading-overlay {
      position: absolute;
      top: 0;
      right: 0;
      width: 44px;
      height: 44px;
      margin-left: 0.75rem;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      color: #fff;
      font-size: 0.65rem;
      letter-spacing: 0.04em;
      opacity: 0;
      pointer-events: none;
      transform: scale(0.8);
      transform-origin: center;
      transition:
        opacity 0.15s ease,
        transform 0.15s ease;
    }

    .global-loading-overlay.visible {
      opacity: 1;
      transform: scale(1);
    }

    .global-loading-spinner {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      border: 2px solid rgba(255, 255, 255, 0.35);
      border-top-color: var(--primary-orange);
      animation: global-loading-spin 0.85s linear infinite;
    }

    .homepage-link--active {
      color: #ea580c !important;
      font-weight: 700;
    }

    .homepage-link--active svg {
      stroke: #ea580c;
    }

    @keyframes global-loading-spin {
      to {
        transform: rotate(360deg);
      }
    }

    html,
    body {
      height: 100%;
      width: 100%;
    }

    body {
      overflow: hidden;
    }

    .employee-layout {
      display: flex;
      min-height: 100vh;
      height: 100vh;
      width: 100%;
    }

    .employee-sidebar {
      width: 260px;
      background: var(--sidebar-bg);
      color: #e2e8f0;
      display: flex;
      flex-direction: column;
      gap: 2rem;
      padding: 1.5rem;
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      height: 100vh;
      overflow-y: auto;
      box-shadow: 4px 0 20px rgba(15, 23, 42, 0.15);
      z-index: 1000;
      transition: transform 0.3s ease;
    }

    .employee-main {
      flex: 1;
      margin-left: 260px;
      width: calc(100% - 260px);
      min-height: 100vh;
      background: #f8fafc;
    }

    .sidebar-brand {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .sidebar-brand img {
      width: 48px;
      height: 48px;
      object-fit: contain;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.08);
      padding: 6px;
    }

    .sidebar-brand strong {
      display: block;
      font-size: 1.1rem;
      letter-spacing: 0.5px;
    }

    .sidebar-brand span {
      font-size: 0.85rem;
      color: #94a3b8;
    }

    .sidebar-label {
      text-transform: uppercase;
      font-size: 0.75rem;
      letter-spacing: 0.1em;
      color: #94a3b8;
      margin-bottom: 0.5rem;
    }

    .sidebar-nav,
    .sidebar-section-nav {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }

    .sidebar-section-nav:empty {
      display: none;
    }

    .sidebar-section-group {
      margin-top: 0.75rem;
      text-transform: uppercase;
      font-size: 0.7rem;
      letter-spacing: 0.12em;
      color: #64748b;
      padding: 0.35rem 0.25rem 0.1rem;
    }

    .sidebar-link,
    .sidebar-section-link {
      border: none;
      border-left: 4px solid transparent;
      padding: 0.75rem 1rem;
      border-radius: 0;
      color: #94a3b8;
      text-decoration: none;
      font-weight: 500;
      font-size: 0.9375rem;
      display: inline-flex;
      align-items: center;
      gap: 0.625rem;
      transition: all 0.2s ease;
      background: transparent;
      cursor: pointer;
    }

    .sidebar-link.active,
    .sidebar-section-link.active {
      background: #1e293b;
      border-left-color: var(--primary-orange);
      color: #ffffff;
      font-weight: 600;
    }

    .sidebar-link:hover,
    .sidebar-section-link:hover {
      background: rgba(255, 255, 255, 0.05);
      color: #e2e8f0;
    }

    .sidebar-section-link {
      width: 100%;
      background: rgba(255, 255, 255, 0.02);
    }

    .sidebar-footer {
      margin-top: auto;
      font-size: 0.8rem;
      color: #94a3b8;
      border-top: 1px solid var(--sidebar-border);
      padding-top: 1rem;
    }

    /* Sidebar Employees Section */
    #sidebar-employees-section {
      margin: 0;
    }

    .sidebar-employees-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      align-items: center;
    }

    .sidebar-employees-list .loading-employees {
      color: #94a3b8;
      font-style: italic;
      font-size: 0.85rem;
      margin: 0;
    }

    .sidebar-employee-avatar-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.25rem;
      cursor: pointer;
      transition: transform 0.2s;
      position: relative;
    }

    .sidebar-employee-avatar-container:hover {
      transform: translateY(-2px);
    }

    .sidebar-employee-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 2px solid var(--primary-orange);
      object-fit: cover;
      transition: all 0.2s;
    }

    .sidebar-employee-avatar-container.inactive .sidebar-employee-avatar {
      filter: grayscale(100%);
      border-color: #64748b;
      opacity: 0.5;
    }

    .sidebar-employee-name {
      font-size: 0.65rem;
      font-weight: 600;
      color: #e2e8f0;
      text-align: center;
      max-width: 50px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .sidebar-employee-avatar-container.inactive .sidebar-employee-name {
      color: #64748b;
    }

    .sidebar-employee-tooltip {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: #334155;
      color: white;
      padding: 0.4rem 0.6rem;
      border-radius: 6px;
      font-size: 0.75rem;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
      margin-bottom: 0.5rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      z-index: 100;
    }

    .sidebar-employee-tooltip::after {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 5px solid transparent;
      border-top-color: #334155;
    }

    .sidebar-employee-avatar-container:hover .sidebar-employee-tooltip {
      opacity: 1;
    }

    .employee-main {
      flex: 1;
      width: 100%;
      min-width: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      background: radial-gradient(circle at top, rgba(255, 107, 53, 0.15), transparent 45%);
    }

    .header-summary h1 {
      margin: 0;
      font-size: 1.75rem;
      font-weight: 700;
      color: #0f172a;
    }

    .header-summary p {
      margin: 0;
      color: #64748b;
      font-size: 0.9rem;
    }

    .header-summary {
      background: linear-gradient(135deg, var(--primary-orange), var(--primary-orange-dark));
      padding: 0.35rem 0.9rem;
      border-radius: 12px;
      box-shadow: 0 10px 24px rgba(255, 107, 53, 0.25);
    }

    .header-summary h1,
    .header-summary p {
      color: #ffffff;
    }

    /* Header User Profile styles moved to components/header-profile.css */

    .employee-bell-btn {
      position: relative;
      background: none;
      border: none;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 50%;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 44px;
      height: 44px;
      flex-shrink: 0;
    }

    .employee-bell-btn:hover {
      background: rgba(15, 23, 42, 0.1);
    }

    .employee-bell-btn svg {
      width: 28px;
      height: 28px;
      stroke: #0f172a;
    }

    .employee-bell-btn.has-notifications {
      background: rgba(255, 107, 53, 0.12);
    }

    .employee-bell-btn.ringing {
      animation: ring 0.5s ease-in-out;
    }

    .employee-bell-btn.pending {
      background: #ef4444;
      animation: bellPulse 2s ease-in-out infinite;
    }

    .employee-bell-btn.pending svg {
      stroke: #fff;
    }

    .employee-bell-btn.confirmed {
      background: #d1fae5;
    }

    .employee-bell-btn.confirmed svg {
      stroke: #0f766e;
    }

    .employee-bell-btn.active {
      background: rgba(16, 185, 129, 0.15);
    }

    .employee-bell-badge {
      position: absolute;
      top: 2px;
      right: 2px;
      background: var(--primary-orange);
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 11px;
      display: none;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      border: 2px solid white;
    }

    @keyframes ring {

      0%,
      100% {
        transform: rotate(0deg);
      }

      10%,
      30%,
      50%,
      70%,
      90% {
        transform: rotate(-12deg);
      }

      20%,
      40%,
      60%,
      80% {
        transform: rotate(12deg);
      }
    }

    /* Ensure header content is spaced out properly */
    .employee-header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 4rem;
      /* h-16 */
      width: 100%;
      padding: 0 1rem;
    }

    .sidebar-toggle-mobile {
      display: none;
      background: none;
      border: none;
      padding: 0.5rem;
      cursor: pointer;
      color: #0f172a;
    }

    @media (max-width: 1024px) {
      .sidebar-toggle-mobile {
        display: block;
      }

      .employee-sidebar {
        position: fixed;
        left: 0;
        top: 0;
        bottom: 0;
        z-index: 2000;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        width: 280px;
        height: 100vh;
      }

      .employee-sidebar.active {
        transform: translateX(0);
      }

      .employee-main {
        margin-left: 0;
        width: 100%;
      }

      .sidebar-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1999;
      }

      .sidebar-overlay.active {
        display: block;
      }
    }

    @keyframes bellPulse {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.1);
      }
    }

    main {
      padding: 2rem 2.5rem 3rem;
      max-width: 1400px;
      width: 100%;
      margin: 0 auto;
      flex: 1;
    }

    .section {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      border: 1px solid #e2e8f0;
      transition: all 0.3s;
    }

    .section:hover {
      box-shadow: 0 4px 16px rgba(255, 107, 53, 0.1);
    }

    .hidden-section {
      display: none !important;
    }

    .section__header {
      border-bottom: 2px solid #f1f5f9;
      padding-bottom: 1rem;
      margin-bottom: 1.5rem;
    }

    .section__header h1,
    .section__header h2 {
      margin: 0 0 0.5rem 0;
      color: #1e293b;
      font-weight: 700;
    }

    .section__header h1 {
      font-size: 1.75rem;
      color: #0f172a;
    }

    .section__header h2 {
      font-size: 1.5rem;
      color: #1e293b;
    }

    .section__header p {
      margin: 0;
      color: #64748b;
      font-size: 0.95rem;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn--primary {
      background: linear-gradient(135deg, var(--primary-orange), var(--primary-orange-dark));
      color: white;
    }

    .btn--primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
    }

    .btn--secondary {
      background: white;
      color: var(--primary-orange);
      border: 2px solid var(--primary-orange);
    }

    .btn--secondary:hover {
      background: var(--primary-orange-light);
    }

    .btn--outline {
      background: transparent;
      color: #64748b;
      border: 2px solid #cbd5e1;
    }

    .btn--outline:hover {
      border-color: var(--primary-orange);
      color: var(--primary-orange);
    }

    .table-wrapper {
      overflow-x: auto;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }

    thead {
      background: linear-gradient(135deg, #f8fafc, #f1f5f9);
    }

    th {
      padding: 1rem;
      text-align: left;
      font-weight: 700;
      color: #475569;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-bottom: 2px solid #e2e8f0;
    }

    td {
      padding: 1rem;
      border-bottom: 1px solid #f1f5f9;
      color: #334155;
    }

    tr:hover {
      background: #fafafa;
    }

    .status {
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      display: inline-block;
    }

    .status--requested {
      background: #fef3c7;
      color: #92400e;
    }

    .status--waiter_accepted {
      background: #dbeafe;
      color: #1e40af;
    }

    .status--kitchen_in_progress {
      background: #fed7aa;
      color: #9a3412;
    }

    .status--ready_for_delivery {
      background: #d1fae5;
      color: #065f46;
    }

    .status--delivered {
      background: #d1fae5;
      color: #065f46;
    }

    .status--new,
    .status--requested {
      background: #fef3c7;
      color: #92400e;
    }

    .status--queued,
    .status--waiter_accepted {
      background: #dbeafe;
      color: #1e40af;
    }

    .status--preparing,
    .status--kitchen_in_progress {
      background: #fed7aa;
      color: #9a3412;
    }

    .status--ready,
    .status--ready_for_delivery {
      background: #d1fae5;
      color: #065f46;
    }

    .status--awaiting_payment {
      background: #fce7f3;
      color: #9d174d;
    }

    .status--paid {
      background: #dcfce7;
      color: #166534;
    }

    .status--cancelled {
      background: #fee2e2;
      color: #991b1b;
    }

    .metric-card {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      border: 1px solid #e2e8f0;
      transition: all 0.3s;
    }

    .metric-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(255, 107, 53, 0.15);
      border-color: var(--primary-orange);
    }

    .metric-card h2 {
      margin: 0 0 0.5rem 0;
      font-size: 0.9rem;
      font-weight: 600;
      color: #64748b;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .metric-card strong {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary-orange);
      display: block;
      margin: 0.5rem 0;
    }

    .metric-card span {
      font-size: 0.85rem;
      color: #94a3b8;
    }

    footer {
      text-align: center;
      padding: 1.5rem 2rem;
      color: #64748b;
      font-size: 0.9rem;
      border-top: 1px solid #e2e8f0;
      background: white;
      margin-top: auto;
    }

    @media (max-width: 1200px) {
      .employee-sidebar {
        width: 240px;
      }
    }

    @media (max-width: 1024px) {
      .employee-layout {
        flex-direction: column;
      }

      .employee-sidebar {
        width: 100%;
        height: auto;
        position: relative;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 1rem;
        box-shadow: none;
      }

      .sidebar-nav,
      .sidebar-section-nav {
        flex-direction: row;
        flex-wrap: wrap;
      }

      .sidebar-link,
      .sidebar-section-link {
        flex: 1 1 200px;
        justify-content: center;
      }

      .employee-header-content {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
      }

      .header-user-section {
        width: 100%;
        justify-content: space-between;
      }
    }

    @media (max-width: 640px) {
      .employee-sidebar {
        flex-direction: column;
      }

      .sidebar-link,
      .sidebar-section-link {
        width: 100%;
      }

      .header-user-info {
        align-items: flex-start;
      }
    }

    /* Mobile Sidebar Toggle Button */
    .sidebar-toggle-btn {
      display: none;
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: var(--primary-orange);
      color: white;
      border: none;
      box-shadow: 0 4px 20px rgba(255, 107, 53, 0.4);
      cursor: pointer;
      z-index: 1001;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    /* Mobile styles for header hamburger */
    .mobile-menu-btn {
      display: none;
      background: none;
      border: none;
      padding: 8px;
      color: #64748b;
      cursor: pointer;
    }

    .mobile-menu-btn svg {
      width: 24px;
      height: 24px;
    }

    .sidebar-toggle-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 24px rgba(255, 107, 53, 0.5);
    }

    .sidebar-toggle-btn svg {
      width: 24px;
      height: 24px;
    }

    /* Sidebar overlay for mobile */
    .sidebar-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 99;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .sidebar-overlay.open {
      display: block;
      opacity: 1;
    }

    @media (max-width: 1024px) {
      .employee-sidebar {
        position: fixed;
        left: -260px;
        top: 0;
        height: 100vh;
        z-index: 100;
        transition: left 0.3s ease;
        box-shadow: 4px 0 20px rgba(15, 23, 42, 0.3);
      }

      .employee-sidebar.open {
        left: 0;
      }

      .employee-main {
        margin-left: 0;
        width: 100%;
        margin-top: 0;
      }

      .sidebar-toggle-btn {
        display: flex;
      }

      .mobile-menu-btn {
        display: block;
        margin-right: 12px;
      }

      .sidebar-overlay {
        display: block;
      }
    }

    @media (max-width: 640px) {
      .employee-sidebar {
        width: 100%;
        max-width: 280px;
        left: -100%;
        max-width: 280px;
      }

      .employee-main main {
        padding: 1rem;
      }

      .sidebar-link,
      .sidebar-section-link {
        width: 100%;
      }

      .header-user-info {
        align-items: flex-start;
      }
    }
  </style>

  <!-- Mobile sidebar toggle button -->
  <button class="sidebar-toggle-btn" id="sidebar-toggle" aria-label="Abrir menú">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
    </svg>
  </button>

  <!-- Sidebar overlay -->
  <div class="sidebar-overlay" id="sidebar-overlay"></div>

  <script>
    // Mobile sidebar toggle
    document.addEventListener('DOMContentLoaded', function () {
      const sidebarToggle = document.getElementById('sidebar-toggle');
      const sidebarOverlay = document.getElementById('sidebar-overlay');
      const sidebar = document.querySelector('.employee-sidebar');

      if (sidebarToggle && sidebar) {
        sidebarToggle.addEventListener('click', function () {
          sidebar.classList.toggle('open');
          if (sidebarOverlay) {
            sidebarOverlay.classList.toggle('open');
          }
        });
      }

      if (sidebarOverlay && sidebar) {
        sidebarOverlay.addEventListener('click', function () {
          sidebar.classList.remove('open');
          sidebarOverlay.classList.remove('open');
        });
      }
    });
  </script>
    <script src="{{ assets_js_employees }}/loading.js"></script>
    <script>
      window.APP_SETTINGS = {{ app_settings | tojson | safe }};
      window.APP_CONFIG = {
        assets_css_employees: '{{ assets_css_employees }}',
        assets_js_employees: '{{ assets_js_employees }}',
        restaurant_assets: '{{ restaurant_assets }}',
        items_per_page: 20
      };
    </script>
  <style>
    :root {
      --sidebar-bg: #1e293b;
      --sidebar-bg-hover: #334155;
      --sidebar-text: #cbd5e1;
      --sidebar-text-muted: #94a3b8;
      --sidebar-active-bg: #ff6b35;
      --sidebar-active-text: #ffffff;
      --header-bg: #ffffff;
      --header-border: #e2e8f0;
      --primary-orange: #ff6b35;
      --primary-orange-dark: #e85a2a;
    }

    /* Sidebar Container */
    .employee-sidebar {
      /* Fix: Reset legacy positioning to allow flexbox layout */
      position: relative;
      top: auto;
      left: auto;
      bottom: auto;

      width: 16rem;
      background: var(--sidebar-bg);
      display: flex;
      flex-direction: column;
      height: 100%;
      z-index: 40;
      transition: transform 0.3s ease-in-out;
      overflow-y: auto;
    }

    /* Sidebar Brand/Logo Area */
    .sidebar-brand {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1.25rem 1rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .sidebar-brand img {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      object-fit: cover;
      flex-shrink: 0;
    }

    .sidebar-brand strong {
      display: block;
      font-size: 0.95rem;
      font-weight: 600;
      color: #ffffff;
      line-height: 1.3;
    }

    .sidebar-brand span {
      display: block;
      font-size: 0.75rem;
      color: var(--sidebar-text-muted);
      margin-top: 2px;
    }

    /* Sidebar Section Labels */
    .sidebar-label {
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--sidebar-text-muted);
      padding: 1rem 1rem 0.5rem;
      margin: 0;
    }

    /* Sidebar Navigation */
    .sidebar-nav {
      display: flex;
      flex-direction: column;
      padding: 0 0.5rem;
    }

    .sidebar-link {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.65rem 0.75rem;
      margin: 2px 0;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--sidebar-text);
      text-decoration: none;
      border-radius: 8px;
      transition: all 0.15s ease;
    }

    .sidebar-link:hover {
      background: var(--sidebar-bg-hover);
      color: #ffffff;
    }

    .sidebar-link.active {
      background: var(--sidebar-active-bg);
      color: var(--sidebar-active-text);
      font-weight: 600;
    }

    /* Sidebar Section Navigation (Module Links) */
    .sidebar-section-nav {
      display: flex;
      flex-direction: column;
      padding: 0 0.5rem;
    }

    .sidebar-section-link {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.65rem 0.75rem;
      margin: 2px 0;
      font-size: 0.85rem;
      color: var(--sidebar-text);
      text-decoration: none;
      border-radius: 8px;
      border: none;
      background: transparent;
      text-align: left;
      cursor: pointer;
      transition: all 0.15s ease;
      width: 100%;
    }

    .sidebar-section-link svg {
      width: 18px;
      height: 18px;
      stroke-width: 2px;
      opacity: 0.7;
      transition: opacity 0.2s;
    }

    .sidebar-section-link:hover {
      background: var(--sidebar-bg-hover);
      color: #ffffff;
    }

    .sidebar-section-link:hover svg {
      opacity: 1;
    }

    .sidebar-section-link.active {
      background: var(--sidebar-active-bg);
      color: var(--sidebar-active-text);
      font-weight: 600;
    }

    .sidebar-section-link.active svg {
      opacity: 1;
      stroke: currentColor;
    }

    .sidebar-section-group {
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--sidebar-text-muted);
      padding: 0.75rem 0.75rem 0.35rem;
      margin-top: 0.5rem;
    }

    /* Sidebar Footer */
    .sidebar-footer {
      margin-top: auto;
      padding: 1rem;
      font-size: 0.7rem;
      color: var(--sidebar-text-muted);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      text-align: center;
    }

    .sidebar-footer strong {
      color: var(--sidebar-text);
    }

    /* Mobile Sidebar */
    @media (max-width: 1024px) {
      .employee-sidebar {
        position: fixed;
        top: 0;
        bottom: 0;
        left: 0;
        transform: translateX(-100%);
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
      }

      .employee-sidebar.open {
        transform: translateX(0);
      }
    }

    /* Header Styles */
    .employee-header {
      background: var(--header-bg);
      border-bottom: 1px solid var(--header-border);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .employee-header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 4rem;
      padding: 0 1.5rem;
    }

    .header-summary h1 {
      font-size: 1.125rem;
      font-weight: 700;
      color: #0f172a;
      margin: 0;
    }

    .header-summary p {
      font-size: 0.75rem;
      color: #64748b;
      margin: 0.125rem 0 0;
    }

    /* Header User Section */
    .header-user-section {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .header-user-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.375rem 0.75rem;
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 9999px;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .header-user-btn:hover {
      background: #f1f5f9;
      border-color: #cbd5e1;
    }

    .header-user-avatar-container {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      overflow: hidden;
      border: 2px solid var(--primary-orange);
      flex-shrink: 0;
    }

    .header-user-avatar {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
      background: var(--primary-orange);
    }

    .header-user-info-text {
      display: flex;
      flex-direction: column;
      text-align: left;
    }

    .header-user-info-text strong {
      font-size: 0.8rem;
      font-weight: 600;
      color: #1e293b;
    }

    .header-user-info-text span {
      font-size: 0.7rem;
      color: #64748b;
    }

    /* User Menu Dropdown */
    .header-user-menu {
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 0.5rem;
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
      min-width: 200px;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.2s ease;
      z-index: 100;
    }

    #header-user-menu.open {
      display: block !important;
      opacity: 1 !important;
      visibility: visible !important;
      pointer-events: auto !important;
      transform: translateY(0);
    }

    .user-menu-header {
      padding: 1rem;
      border-bottom: 1px solid #e2e8f0;
    }

    .user-menu-header strong {
      display: block;
      font-size: 0.9rem;
      color: #0f172a;
    }

    .user-menu-header span {
      font-size: 0.75rem;
      color: #64748b;
    }

    .user-menu-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      width: 100%;
      padding: 0.75rem 1rem;
      border: none;
      background: transparent;
      font-size: 0.875rem;
      color: #475569;
      cursor: pointer;
      transition: background 0.15s ease;
    }

    .user-menu-item:hover {
      background: #f8fafc;
    }

    .user-menu-item.logout {
      color: #dc2626;
    }

    .user-menu-item.logout:hover {
      background: #fef2f2;
    }

    /* Notification Bell */
    .employee-bell-btn {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border: none;
      background: #f8fafc;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .employee-bell-btn:hover {
      background: #f1f5f9;
    }

    .employee-bell-btn svg {
      width: 20px;
      height: 20px;
      color: #64748b;
    }

    .employee-bell-badge {
      position: absolute;
      top: -2px;
      right: -2px;
      min-width: 18px;
      height: 18px;
      padding: 0 5px;
      background: var(--primary-orange);
      color: white;
      font-size: 0.65rem;
      font-weight: 700;
      border-radius: 9999px;
      display: none;
      align-items: center;
      justify-content: center;
    }

    .employee-bell-btn.has-notifications .employee-bell-badge {
      display: flex;
    }

    /* Main Content Area */
    .employee-main {
      /* Fix: Reset legacy margins to allow flexbox layout */
      margin-left: 0;
      width: 100%;

      flex: 1;
      display: flex;
      flex-direction: column;
      min-width: 0;
      height: 100vh;
      background: #f8fafc;
    }

    #app-main {
      flex: 1;
      overflow-y: auto;
      padding: 0;
    }
  </style>
</head>

<body>
  <div class="employee-layout" style="display: flex; width: 100%; height: 100vh; overflow: hidden">
    <aside class="employee-sidebar shadow-lg lg:shadow-none" style="flex-shrink: 0">
      <div class="sidebar-brand">
        <img src="{{ restaurant_assets | to_https }}/branding/logo.png" alt="{{ restaurant_name }} logo"
          onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Ccircle cx=%2250%22 cy=%2250%22 r=%2240%22 fill=%22%23ff6b35%22/%3E%3Ctext x=%2250%22 y=%2260%22 text-anchor=%22middle%22 font-size=%2240%22 fill=%22white%22 font-family=%22sans-serif%22%3E%3CP/text%3E%3C/svg%3E'" />
        <div style="display: flex; flex-direction: column; justify-content: center;">
          <strong style="font-size: 1.1rem; color: #fff; letter-spacing: -0.01em;">{{ restaurant_name| title}}</strong>
          <span style="font-size: 0.75rem; color: #94a3b8; font-weight: 500;">Operación</span>
        </div>
      </div>



      <div id="sidebar-modules" style="display: none">
        <p class="sidebar-label">Módulos de operación</p>
        <div id="section-nav" class="sidebar-section-nav"></div>
      </div>

      <div class="sidebar-footer">
        <strong>{{ current_year }}</strong> · {{ restaurant_name| title}}<br />
        Operación centralizada
      </div>
    </aside>

    <div class="employee-main"
      style="display: flex; flex-direction: column; flex: 1; min-width: 0; height: 100vh; width: 100%;">
      <header class="employee-header w-full bg-white shadow-sm sticky top-0 z-50" style="flex-shrink: 0; width: 100%">
        <div class="w-full px-4 sm:px-6 lg:px-8">
          <div class="employee-header-content flex justify-between items-center h-16">
            <div class="flex items-center">
              <button id="mobile-sidebar-toggle" class="mobile-menu-btn" aria-label="Abrir menú">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
              </button>
              {% block header_branding %}
              <div class="header-summary">
                <h1 class="text-lg font-bold text-gray-900">{{ restaurant_name| title}}</h1>
                <p class="text-xs text-gray-500">Control operativo en tiempo real</p>
              </div>
              {% endblock %}
            </div>

            <div class="header-user-section">
              <button class="employee-bell-btn" id="employee-bell-btn" type="button" title="Notificaciones">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
                </svg> </svg>
                <span class="employee-bell-badge" id="employee-bell-badge">0</span>
              </button>
              {% if current_user %}
              <div class="header-user-dropdown-container">
                <button class="header-user-btn" onclick="toggleUserMenu()" aria-expanded="false" aria-haspopup="true">
                  <div style="position: relative">
                    <div class="global-loading-overlay" id="global-loading" role="status" aria-live="polite">
                      <div class="global-loading-spinner"></div>
                    </div>
                    <div class="header-user-avatar-container">
                      <img class="header-user-avatar"
                        src="{{ current_user.avatar or ('data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 100 100\'%3E%3Ccircle cx=\'50\' cy=\'50\' r=\'50\' fill=\'%23ff6b35\'/%3E%3Ctext x=\'50\' y=\'62\' text-anchor=\'middle\' font-size=\'45\' fill=\'white\' font-family=\'system-ui, sans-serif\' font-weight=\'600\'%3E' + current_user.name[0]|upper + '%3C/text%3E%3C/svg%3E') }}"
                        alt="{{ current_user.name }}" />
                    </div>
                  </div>
                  <div class="header-user-info-text">
                    <strong>{{ current_user.name }}</strong>
                    <span>{{ current_user.role }}</span>
                  </div>
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                    class="header-user-chevron">
                    <polyline points="6 9 12 15 18 9"></polyline>
                  </svg>
                </button>

                <div class="header-user-menu" id="header-user-menu">
                  <div class="user-menu-header">
                    <strong>{{ current_user.name }}</strong>
                    <span>{{ current_user.role }}</span>
                  </div>
                  <div class="user-menu-divider"></div>
                  {% set logout_endpoint = (app_context ~ '_app.logout') if
                  app_context in ['waiter', 'chef', 'cashier', 'admin', 'system'] else 'auth.logout' %}
                  <a href="{{ url_for(logout_endpoint) }}" class="user-menu-item logout"
                    style="display: flex; text-decoration: none;"
                    onclick="try { sessionStorage.removeItem('pronto_last_event_id'); sessionStorage.removeItem('pronto_realtime_after_id'); } catch(e) {}">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" class="w-4 h-4 mr-2"
                      stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round"
                        d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                    </svg>
                    Cerrar Sesión
                  </a>
                </div>
              </div>
              <script>
                function toggleUserMenu() {
                  const menu = document.getElementById('header-user-menu');
                  const btn = document.querySelector('.header-user-btn');
                  const isOpen = menu.classList.contains('open');

                  if (isOpen) {
                    menu.classList.remove('open');
                    btn.setAttribute('aria-expanded', 'false');
                  } else {
                    menu.classList.add('open');
                    btn.setAttribute('aria-expanded', 'true');
                  }
                }

                // Close menu when clicking outside
                document.addEventListener('click', function (event) {
                  const container = document.querySelector('.header-user-dropdown-container');
                  const menu = document.getElementById('header-user-menu');
                  if (
                    container &&
                    !container.contains(event.target) &&
                    menu.classList.contains('open')
                  ) {
                    menu.classList.remove('open');
                    document
                      .querySelector('.header-user-btn')
                      .setAttribute('aria-expanded', 'false');
                  }
                });
              </script>
              {% endif %}
            </div>
          </div>
        </div>
      </header>

      <main id="app-main" class="flex-1 w-full overflow-y-auto" style="min-height: 0; width: 100%; overflow-y: auto">
        {% block content %}{% endblock %}
      </main>
    </div>
    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <script type="module" src="{{ assets_js_employees }}/base.js"></script>
    <script src="{{ assets_js_employees }}/keyboard-shortcuts.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const homeLink = document.getElementById('set-homepage-link');
        const label = homeLink?.querySelector('[data-homepage-label]');
        const savedHome = localStorage.getItem('employee_homepage_url');
        const currentPath = window.location.pathname || '';

        if (homeLink && savedHome === currentPath) {
          homeLink.classList.add('homepage-link--active');
          if (label) label.textContent = 'Página de inicio';
        }

        // SPA Navigation
        const sidebar = document.querySelector('.sidebar-nav');
        if (sidebar) {
          sidebar.addEventListener('click', async (e) => {
            const link = e.target.closest('a.sidebar-link');
            if (!link || !link.href || link.target === '_blank' || e.ctrlKey || e.metaKey) return;

            const url = new URL(link.href);
            if (url.origin !== window.location.origin) return;

            // For simplicity and stability, if navigating TO dashboard or FROM dashboard, do full reload
            // to ensure complex scripts (sockets, modules) are handled correctly initially.
            // Or try full SPA. User wants "menu moves with scripting".
            // Let's try full SPA logic.

            e.preventDefault();

            const prevActive = sidebar.querySelectorAll('.active');
            prevActive.forEach(el => el.classList.remove('active'));
            link.classList.add('active');

            const overlay = document.getElementById('global-loading');
            if (overlay) overlay.classList.add('visible');

            try {
              // Cleanup Sockets logic
              if (window.socket && typeof window.socket.disconnect === 'function') {
                try { window.socket.disconnect(); } catch (e) { }
                window.socket = null;
              }

              const response = await fetch(link.href);
              if (!response.ok) throw new Error('Network response error');
              const html = await response.text();

              const parser = new DOMParser();
              const newDoc = parser.parseFromString(html, 'text/html');

              // Replace Main
              const newMain = newDoc.getElementById('app-main');
              const currentMain = document.getElementById('app-main');
              if (newMain && currentMain) {
                currentMain.innerHTML = newMain.innerHTML;
                // Reset main attributes (like padding styles from our previous fix)
                currentMain.setAttribute('style', newMain.getAttribute('style') || '');
              } else {
                window.location.href = link.href;
                return;
              }

              document.title = newDoc.title;
              history.pushState({}, '', link.href);

              // Re-execute scripts
              // 1. Scripts in main
              currentMain.querySelectorAll('script').forEach(oldS => {
                const newS = document.createElement('script');
                Array.from(oldS.attributes).forEach(attr => newS.setAttribute(attr.name, attr.value));
                newS.textContent = oldS.textContent;
                oldS.parentNode.replaceChild(newS, oldS);
              });

              // 2. Scripts at body level (block scripts)
              // Filtering common framework scripts
              newDoc.querySelectorAll('body > script').forEach(s => {
                if (s.src && (
                  s.src.includes('base.js') ||
                  s.src.includes('loading.js') ||
                  s.src.includes('keyboard-shortcuts.js')
                )) return;
                const newS = document.createElement('script');
                if (s.src) newS.src = s.src;
                if (s.type) newS.type = s.type;
                if (s.textContent) newS.textContent = s.textContent;
                document.body.appendChild(newS);
              });

              if (window.setupSidebarModules) setupSidebarModules();

            } catch (err) {
              console.error('SPA nav error', err);
              window.location.href = link.href;
            } finally {
              if (overlay) overlay.classList.remove('visible');
            }
          });

          // Handle Back/Forward
          window.addEventListener('popstate', () => {
            window.location.reload();
          });
        }
      });

      function setupSidebarModules() {
        const sidebarModules = document.getElementById('sidebar-modules');
        const sectionNavContainer = document.getElementById('section-nav');
        const mainContainer = document.querySelector('main');

        if (!sidebarModules || !sectionNavContainer) {
          return;
        }

        const sections = Array.from(document.querySelectorAll('main .section'));

        if (!sections.length) {
          sidebarModules.style.display = 'none';
          sectionNavContainer.innerHTML = '';
          return;
        }

        const sectionIndex = new Map();
        sections.forEach((section, index) => {
          sectionIndex.set(section, index);
          if (!section.id) {
            section.id = `section-${index + 1}`;
          }
        });

        sidebarModules.style.display = 'block';
        sectionNavContainer.innerHTML = '';

        const groupedSections = new Map();
        const groupOrder = [];

        sections.forEach((section) => {
          const group = section.dataset.menuGroup || 'GENERAL';
          if (!groupedSections.has(group)) {
            groupedSections.set(group, []);
            groupOrder.push(group);
          }
          groupedSections.get(group).push(section);
        });

        const activateSection = (targetId) => {
          sections.forEach((section) => {
            section.classList.toggle('hidden-section', section.id !== targetId);
          });

          sectionNavContainer.querySelectorAll('.sidebar-section-link').forEach((link) => {
            link.classList.toggle('active', link.dataset.target === targetId);
          });

          if (mainContainer && typeof mainContainer.scrollTo === 'function') {
            mainContainer.scrollTo({ top: 0, behavior: 'smooth' });
          }
        };

        window.activateSection = activateSection;

        const defaultSection = sections[0];
        sections.forEach((section, index) => {
          if (index !== 0) {
            section.classList.add('hidden-section');
          } else {
            section.classList.remove('hidden-section');
          }
        });

        groupOrder.forEach((group) => {
          if (group) {
            const groupLabel = document.createElement('div');
            groupLabel.className = 'sidebar-section-group';
            groupLabel.textContent = group;
            sectionNavContainer.appendChild(groupLabel);
          }

          const groupSections = groupedSections.get(group) || [];
          groupSections.forEach((section) => {
            const heading =
              section.querySelector('.section__header h1') ||
              section.querySelector('.section__header h2');
            const fallbackIndex = (sectionIndex.get(section) || 0) + 1;
            const title =
              section.dataset.menuTitle ||
              section.dataset.menu_title ||
              (heading ? heading.textContent.trim() : `Sección ${fallbackIndex}`);
            const iconName = section.dataset.icon;

            const button = document.createElement('button');
            button.type = 'button';
            button.className =
              'sidebar-section-link' + (section === defaultSection ? ' active' : '');
            button.dataset.target = section.id;

            if (iconName) {
              button.innerHTML = `<i data-lucide="${iconName}"></i> <span>${title}</span>`;
            } else {
              button.textContent = title;
            }

            button.addEventListener('click', () => activateSection(section.id));
            sectionNavContainer.appendChild(button);
          });
        });

        if (window.Lucide && window.Lucide.createIcons) {
          window.Lucide.createIcons({ icons: window.Lucide.icons });
        }
      }

      window.EmployeeBell = {
        button: null,
        badge: null,
        count: 0,
        currentState: 'idle',
        notificationsPanel: null,
        init() {
          this.button = document.getElementById('employee-bell-btn');
          this.badge = document.getElementById('employee-bell-badge');
          this.notificationsPanel = document.getElementById('notifications-panel');

          if (this.button) {
            this.button.addEventListener('click', () => {
              this.toggleNotificationsPanel();
            });
          }
        },
        toggleNotificationsPanel() {
          // Si WaiterPanel está disponible, delegar a él (mantiene lógica de llamadas)
          if (window.WaiterPanel?.toggleNotificationsPanel) {
            window.WaiterPanel.toggleNotificationsPanel();
            return;
          }

          // Si no hay WaiterPanel, manejar el toggle directamente
          if (!this.notificationsPanel) {
            console.warn('[EmployeeBell] Notifications panel not found');
            return;
          }

          const isOpen = this.notificationsPanel.classList.contains('open');
          if (isOpen) {
            this.notificationsPanel.classList.remove('open');
            setTimeout(() => {
              if (this.notificationsPanel) {
                this.notificationsPanel.style.display = 'none';
              }
            }, 300);
            this.setState(this.count > 0 ? 'pending' : 'idle');
          } else {
            this.notificationsPanel.style.display = 'block';
            requestAnimationFrame(() => {
              if (this.notificationsPanel) {
                this.notificationsPanel.classList.add('open');
              }
            });
            this.setState('active');
          }
        },
        setCount(count) {
          this.count = count;
          if (!this.badge || !this.button) return;

          if (count > 0) {
            this.badge.textContent = count;
            this.badge.style.display = 'flex';
            this.button.classList.add('has-notifications');
          } else {
            this.badge.style.display = 'none';
            this.button.classList.remove('has-notifications');
          }
        },
        setState(state) {
          if (!this.button) return;
          this.button.classList.remove('pending', 'confirmed', 'ringing', 'active');
          if (state && state !== 'idle') {
            this.button.classList.add(state);
          }
          this.currentState = state || 'idle';
        },
      };



      document.addEventListener('DOMContentLoaded', () => {
        setupSidebarModules();
        window.EmployeeBell.init();
      });
    </script>
    <script>
      // Unified Toast Notification System - Single source of truth
      (function () {
        const ToastManager = {
          container: null,
          // Default duration: 3 seconds (3000ms)
          DEFAULT_DURATION: 3000,

          init() {
            if (this.container) return;
            this.container = document.getElementById('toast-container');
            if (!this.container) {
              this.container = document.createElement('div');
              this.container.id = 'toast-container';
              this.container.className = 'toast-container';
              this.container.setAttribute('aria-live', 'polite');
              this.container.setAttribute('aria-atomic', 'true');
              document.body.appendChild(this.container);
            }
          },

          show(message, type = 'info', title = '', duration = null) {
            if (!this.container) this.init();

            const text = String(message || '').trim();
            if (!text) return null;

            // Ensure duration is a valid positive number, fallback to default
            const effectiveDuration = (typeof duration === 'number' && duration > 0)
              ? duration
              : (window.APP_CONFIG?.waiter_notification_timeout || this.DEFAULT_DURATION);

            const toast = document.createElement('div');
            toast.className = `toast toast--${type}`;
            toast.dataset.dismissing = 'false';

            const icons = {
              success: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>',
              error: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>',
              warning: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>',
              info: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>'
            };

            toast.innerHTML = `
              <div class="toast__icon">${icons[type] || icons.info}</div>
              <div class="toast__content">
                ${title ? `<p class="toast__title">${title}</p>` : ''}
                <p class="toast__message">${text}</p>
              </div>
              <button class="toast__close" aria-label="Cerrar notificación">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            `;

            // Close button handler
            const closeBtn = toast.querySelector('.toast__close');
            if (closeBtn) {
              closeBtn.addEventListener('click', () => this.dismiss(toast));
            }

            // Click anywhere on toast to dismiss
            toast.addEventListener('click', (e) => {
              if (!e.target.closest('.toast__close')) {
                this.dismiss(toast);
              }
            });

            this.container.appendChild(toast);

            // Auto dismiss after duration
            const timerId = setTimeout(() => this.dismiss(toast), effectiveDuration);
            toast._dismissTimer = timerId;

            return toast;
          },

          dismiss(toast) {
            if (!toast || !toast.parentElement) return;
            if (toast.dataset.dismissing === 'true') return;
            toast.dataset.dismissing = 'true';

            if (toast._dismissTimer) {
              clearTimeout(toast._dismissTimer);
              toast._dismissTimer = null;
            }

            toast.classList.add('toast--exiting');
            setTimeout(() => {
              if (toast.parentElement) {
                toast.remove();
              }
            }, 300);
          },

          success(message, title = 'Éxito') {
            return this.show(message, 'success', title);
          },

          error(message, title = 'Error') {
            return this.show(message, 'error', title, 8000);
          },

          warning(message, title = 'Advertencia') {
            return this.show(message, 'warning', title);
          },

          info(message, title = 'Información') {
            return this.show(message, 'info', title);
          },

          clearAll() {
            if (!this.container) return;
            const toasts = this.container.querySelectorAll('.toast');
            toasts.forEach(toast => this.dismiss(toast));
          }
        };

        // Initialize and expose globally
        ToastManager.init();
        window.ToastManager = ToastManager;
        window.showToast = (message, type, title, duration) => ToastManager.show(message, type, title, duration);
        // Legacy alias for backward compatibility
        window.showNotification = (message, type) => ToastManager.show(message, type);
      })();

      // Mobile Sidebar Logic
      document.addEventListener('DOMContentLoaded', () => {
        const sidebar = document.querySelector('.employee-sidebar');
        const overlay = document.getElementById('sidebar-overlay');
        const toggleBtn = document.getElementById('mobile-sidebar-toggle');
        const fabBtn = document.querySelector('.sidebar-toggle-btn');

        function toggleSidebar() {
          sidebar?.classList.toggle('open');
          overlay?.classList.toggle('open');
        }

        toggleBtn?.addEventListener('click', toggleSidebar);
        fabBtn?.addEventListener('click', toggleSidebar);
        overlay?.addEventListener('click', toggleSidebar);

        // Close sidebar when clicking a link on mobile
        sidebar?.querySelectorAll('.sidebar-link').forEach(link => {
          link.addEventListener('click', () => {
            if (window.innerWidth <= 1024) {
              toggleSidebar();
            }
          });
        });
      });
    </script>


    {% block scripts %}{% endblock %}
</body>

</html>
