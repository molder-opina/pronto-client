{% extends "base.html" %} {% block header_branding %}
<div style="display: flex; align-items: center; gap: 2rem">
  <div>
    <h1 class="text-lg font-bold text-gray-900">Gesti√≥n de Roles Personalizados</h1>
    <p class="text-xs text-gray-500">Crea y administra roles con permisos granulares</p>
  </div>
  <button
    id="create-role-btn"
    class="btn btn-primary"
    style="
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-weight: 600;
      font-size: 0.85rem;
      cursor: pointer;
      border: none;
      background: #ff6b35;
      color: white;
    "
  >
    <svg
      width="18"
      height="18"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
    >
      <line x1="12" y1="5" x2="12" y2="19"></line>
      <line x1="5" y1="12" x2="19" y2="12"></line>
    </svg>
    Crear Nuevo Rol
  </button>
</div>
{% endblock %} {% block content %}

<div class="roles-container" style="max-width: 1400px; margin: 0 auto; padding: 2rem">
  <!-- Roles List -->
  <div class="roles-grid" id="roles-list">
    <!-- Will be populated by JS -->
  </div>
</div>

<!-- Create/Edit Role Modal -->
<div id="role-modal" class="modal">
  <div class="modal-content modal-large">
    <div class="modal-header">
      <h2 id="modal-title">Crear Nuevo Rol</h2>
      <button class="modal-close" onclick="closeRoleModal()">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <form id="role-form">
      <div class="modal-body">
        <div class="modal-tabs" role="tablist">
          <button
            type="button"
            class="modal-tab active"
            data-tab="info"
            role="tab"
            aria-selected="true"
          >
            Informaci√≥n
          </button>
          <button
            type="button"
            class="modal-tab"
            data-tab="permissions"
            role="tab"
            aria-selected="false"
          >
            Permisos
          </button>
        </div>

        <div class="modal-tab-panel active" data-tab="info" role="tabpanel">
          <div class="form-section">
            <h3>Informaci√≥n del Rol</h3>
            <div class="form-grid">
              <div class="form-group">
                <label for="role_code">C√≥digo del Rol *</label>
                <input
                  type="text"
                  id="role_code"
                  name="role_code"
                  required
                  pattern="^[a-z_][a-z0-9_]*$"
                  placeholder="ej: shift_manager"
                />
                <small>Solo min√∫sculas, n√∫meros y guiones bajos. Empieza con letra.</small>
              </div>

              <div class="form-group">
                <label for="role_name">Nombre del Rol *</label>
                <input
                  type="text"
                  id="role_name"
                  name="role_name"
                  required
                  placeholder="ej: Gerente de Turno"
                />
              </div>

              <div class="form-group">
                <label for="color">Color</label>
                <input type="color" id="color" name="color" value="#4F46E5" />
              </div>

              <div class="form-group">
                <label for="icon">√çcono (opcional)</label>
                <input type="text" id="icon" name="icon" placeholder="ej: user-shield" />
              </div>

              <div class="form-group full-width">
                <label for="description">Descripci√≥n</label>
                <textarea
                  id="description"
                  name="description"
                  rows="2"
                  placeholder="Descripci√≥n del rol y sus responsabilidades"
                ></textarea>
              </div>

              <div class="form-group full-width">
                <label class="checkbox-label">
                  <input type="checkbox" id="is_active" name="is_active" checked />
                  <span>Rol activo</span>
                </label>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-tab-panel" data-tab="permissions" role="tabpanel">
          <div class="form-section">
            <h3>Permisos</h3>
            <p class="help-text">Selecciona los permisos que tendr√° este rol</p>

            <div class="permissions-grid" id="permissions-grid">
              <!-- Orders -->
              <div class="permission-group">
                <h4>üì¶ Pedidos</h4>
                <div class="permission-checks">
                  <label
                    ><input type="checkbox" data-resource="orders" data-action="read" /> Ver</label
                  >
                  <label
                    ><input type="checkbox" data-resource="orders" data-action="create" />
                    Crear</label
                  >
                  <label
                    ><input type="checkbox" data-resource="orders" data-action="update" />
                    Modificar</label
                  >
                  <label
                    ><input type="checkbox" data-resource="orders" data-action="delete" />
                    Eliminar</label
                  >
                  <label
                    ><input type="checkbox" data-resource="orders" data-action="approve" />
                    Aprobar</label
                  >
                </div>
              </div>

              <!-- Menu -->
              <div class="permission-group">
                <h4>üçΩÔ∏è Men√∫</h4>
                <div class="permission-checks">
                  <label
                    ><input type="checkbox" data-resource="menu" data-action="read" /> Ver</label
                  >
                  <label
                    ><input type="checkbox" data-resource="menu" data-action="create" />
                    Crear</label
                  >
                  <label
                    ><input type="checkbox" data-resource="menu" data-action="update" />
                    Modificar</label
                  >
                  <label
                    ><input type="checkbox" data-resource="menu" data-action="delete" />
                    Eliminar</label
                  >
                </div>
              </div>

              <!-- Customers -->
              <div class="permission-group">
                <h4>üë• Clientes</h4>
                <div class="permission-checks">
                  <label
                    ><input type="checkbox" data-resource="customers" data-action="read" />
                    Ver</label
                  >
                  <label
                    ><input type="checkbox" data-resource="customers" data-action="create" />
                    Crear</label
                  >
                  <label
                    ><input type="checkbox" data-resource="customers" data-action="update" />
                    Modificar</label
                  >
                  <label
                    ><input type="checkbox" data-resource="customers" data-action="delete" />
                    Eliminar</label
                  >
                </div>
              </div>

              <!-- Sessions -->
              <div class="permission-group">
                <h4>ü™ë Sesiones</h4>
                <div class="permission-checks">
                  <label
                    ><input type="checkbox" data-resource="sessions" data-action="read" />
                    Ver</label
                  >
                  <label
                    ><input type="checkbox" data-resource="sessions" data-action="create" />
                    Crear</label
                  >
                  <label
                    ><input type="checkbox" data-resource="sessions" data-action="update" />
                    Modificar</label
                  >
                  <label
                    ><input type="checkbox" data-resource="sessions" data-action="close" />
                    Cerrar</label
                  >
                </div>
              </div>

              <!-- Employees -->
              <div class="permission-group">
                <h4>üë®‚Äçüíº Empleados</h4>
                <div class="permission-checks">
                  <label
                    ><input type="checkbox" data-resource="employees" data-action="read" />
                    Ver</label
                  >
                  <label
                    ><input type="checkbox" data-resource="employees" data-action="create" />
                    Crear</label
                  >
                  <label
                    ><input type="checkbox" data-resource="employees" data-action="update" />
                    Modificar</label
                  >
                  <label
                    ><input type="checkbox" data-resource="employees" data-action="delete" />
                    Eliminar</label
                  >
                </div>
              </div>

              <!-- Reports -->
              <div class="permission-group">
                <h4>üìä Reportes</h4>
                <div class="permission-checks">
                  <label
                    ><input type="checkbox" data-resource="reports" data-action="read" /> Ver</label
                  >
                  <label
                    ><input type="checkbox" data-resource="reports" data-action="export" />
                    Exportar</label
                  >
                </div>
              </div>

              <!-- Tables -->
              <div class="permission-group">
                <h4>ü™ë Mesas</h4>
                <div class="permission-checks">
                  <label
                    ><input type="checkbox" data-resource="tables" data-action="read" /> Ver</label
                  >
                  <label
                    ><input type="checkbox" data-resource="tables" data-action="update" />
                    Modificar</label
                  >
                </div>
              </div>

              <!-- Settings -->
              <div class="permission-group">
                <h4>‚öôÔ∏è Configuraci√≥n</h4>
                <div class="permission-checks">
                  <label
                    ><input type="checkbox" data-resource="settings" data-action="read" />
                    Ver</label
                  >
                  <label
                    ><input type="checkbox" data-resource="settings" data-action="update" />
                    Modificar</label
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeRoleModal()">Cancelar</button>
        <button type="submit" class="btn btn-primary">
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          Guardar Rol
        </button>
      </div>
    </form>
  </div>
</div>

<style>
  .roles-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem;
  }

  .roles-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 2rem;
  }

  .roles-header h1 {
    font-size: 2rem;
    font-weight: 700;
    color: #0f172a;
    margin: 0 0 0.5rem 0;
  }

  .subtitle {
    color: #64748b;
    margin: 0;
  }

  .roles-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 1.5rem;
  }

  .role-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    border-left: 4px solid #4f46e5;
    transition: all 0.2s;
    position: relative;
  }

  .role-card:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    transform: translateY(-2px);
  }

  .role-card.inactive {
    opacity: 0.6;
  }

  .role-card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
  }

  .role-info h3 {
    font-size: 1.25rem;
    font-weight: 600;
    color: #0f172a;
    margin: 0 0 0.25rem 0;
  }

  .role-code {
    font-size: 0.875rem;
    color: #64748b;
    font-family: 'Courier New', monospace;
    background: #f1f5f9;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
  }

  .role-actions {
    display: flex;
    gap: 0.5rem;
  }

  .icon-btn {
    width: 32px;
    height: 32px;
    border: none;
    background: #f1f5f9;
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
  }

  .icon-btn:hover {
    background: #e2e8f0;
  }

  .icon-btn.delete:hover {
    background: #fee;
    color: #dc2626;
  }

  .role-description {
    color: #64748b;
    font-size: 0.875rem;
    margin-bottom: 1rem;
    line-height: 1.5;
  }

  .role-stats {
    display: flex;
    gap: 1rem;
    padding-top: 1rem;
    border-top: 1px solid #e2e8f0;
  }

  .stat {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: #64748b;
  }

  .stat svg {
    color: #94a3b8;
  }

  /* Modal Styles */
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    align-items: center;
    justify-content: center;
    padding: 2rem;
  }

  .modal.active {
    display: flex;
  }

  .modal-content {
    background: white;
    border-radius: 12px;
    width: 100%;
    max-width: 600px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  }

  .modal-large {
    max-width: 900px;
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    border-bottom: 1px solid #e2e8f0;
  }

  .modal-header h2 {
    font-size: 1.5rem;
    font-weight: 600;
    color: #0f172a;
    margin: 0;
  }

  .modal-close {
    background: none;
    border: none;
    cursor: pointer;
    color: #64748b;
    padding: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 6px;
    transition: all 0.2s;
  }

  .modal-close:hover {
    background: #f1f5f9;
    color: #0f172a;
  }

  .modal-body {
    padding: 1.5rem;
  }

  .modal-tabs {
    display: flex;
    gap: 0.5rem;
    border-bottom: 1px solid #e2e8f0;
    margin-bottom: 1.5rem;
  }

  .modal-tab {
    border: none;
    background: transparent;
    color: #64748b;
    font-weight: 600;
    padding: 0.5rem 0.75rem;
    cursor: pointer;
    border-bottom: 2px solid transparent;
  }

  .modal-tab.active {
    color: #0f172a;
    border-bottom-color: #ff6b35;
  }

  .modal-tab-panel {
    display: none;
  }

  .modal-tab-panel.active {
    display: block;
  }

  .modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
    padding: 1.5rem;
    border-top: 1px solid #e2e8f0;
  }

  .form-section {
    margin-bottom: 2rem;
  }

  .form-section h3 {
    font-size: 1.125rem;
    font-weight: 600;
    color: #0f172a;
    margin: 0 0 1rem 0;
  }

  .help-text {
    color: #64748b;
    font-size: 0.875rem;
    margin: 0 0 1rem 0;
  }

  .form-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
  }

  .form-group {
    display: flex;
    flex-direction: column;
  }

  .form-group.full-width {
    grid-column: 1 / -1;
  }

  .form-group label {
    font-size: 0.875rem;
    font-weight: 500;
    color: #475569;
    margin-bottom: 0.5rem;
  }

  .form-group input,
  .form-group select,
  .form-group textarea {
    padding: 0.75rem;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    font-size: 0.95rem;
    font-family: inherit;
    transition: all 0.2s;
  }

  .form-group input:focus,
  .form-group select:focus,
  .form-group textarea:focus-visible {
    outline: none;
    border-color: var(--primary-orange);
    box-shadow: 0 0 0 3px var(--primary-orange-light);
  }

  .form-group small {
    font-size: 0.8125rem;
    color: #94a3b8;
    margin-top: 0.25rem;
  }

  .checkbox-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
  }

  .checkbox-label input[type='checkbox'] {
    width: 18px;
    height: 18px;
    cursor: pointer;
  }

  /* Permissions Grid */
  .permissions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1.5rem;
  }

  .permission-group {
    background: #f8fafc;
    padding: 1rem;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
  }

  .permission-group h4 {
    font-size: 0.95rem;
    font-weight: 600;
    color: #0f172a;
    margin: 0 0 0.75rem 0;
  }

  .permission-checks {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .permission-checks label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: #475569;
    cursor: pointer;
  }

  .permission-checks input[type='checkbox'] {
    width: 16px;
    height: 16px;
    cursor: pointer;
  }

  .btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 8px;
    font-size: 0.95rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-primary {
    background: var(--primary-orange);
    color: white;
  }

  .btn-primary:hover {
    background: var(--primary-orange-dark);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
  }

  .btn-secondary {
    background: #f1f5f9;
    color: #475569;
  }

  .btn-secondary:hover {
    background: #e2e8f0;
  }
</style>

<script src="{{ assets_js_employees }}/roles_management.js"></script>
{% endblock %}
