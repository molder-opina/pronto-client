{# Template fragment for a single order row #} {% set customer_name = order.customer.name if
order.customer else '' %} {% set raw_customer_email = (order.customer.email or '') if order.customer
else '' %} {% if raw_customer_email and raw_customer_email.startswith('anonimo+') %} {% set
raw_customer_email = '' %} {% endif %} {% set order_email = order.customer_email or '' %} {% if
order_email and order_email.startswith('anonimo+') %} {% set order_email = '' %} {% endif %} {% set
customer_email = raw_customer_email or order_email %} {% set customer_name_upper = (customer_name or
'')|upper %} {% if customer_email and (not customer_name or customer_name_upper in ['INVITADO',
'CLIENTE ANONIMO', 'CLIENTE ANÃ“NIMO', 'ANONIMO', 'ANÃ“NIMO', 'CLIENTE']) %} {% set
customer_display_name = customer_email %} {% elif customer_name %} {% set customer_display_name =
customer_name %} {% else %} {% set customer_display_name = 'Cliente' %} {% endif %} {% set
status_value = order.workflow_status_legacy or order.workflow_status %}
<tr
  data-order-id="{{ order.id }}"
  data-status="{{ status_value }}"
  data-session-id="{{ order.session_id }}"
  data-session-status="{{ order.session.status }}"
  data-paid-at="{{ order.session.closed_at.isoformat() if order.session.closed_at else '' }}"
  data-created-at="{{ order.created_at }}"
  data-session-opened="{{ order.session.opened_at }}"
  data-table-number="{{ order.session.table_number or '' }}"
  data-customer-id="{{ order.customer.id if order.customer else '' }}"
  data-customer-name="{{ customer_display_name }}"
  data-customer-email="{{ customer_email }}"
  data-customer-phone="{{ order.customer.phone if order.customer else '' }}"
  data-customer-description="{{ (order.customer.physical_description or '')|e if order.customer else '' }}"
  data-customer-avatar="{{ order.customer.avatar if order.customer else '' }}"
  data-waiter-name="{{ order.waiter_name or '' }}"
  data-waiter-id="{{ order.waiter_id or '' }}"
  data-chef-id="{{ order.chef_id or '' }}"
  data-notes="{{ (order.session.notes or '')|e }}"
  data-waiter-notes="{{ (order.waiter_notes or '')|e }}"
  data-status-display="{{ order.status_display or '' }}"
>
  <td>
    <button
      type="button"
      class="star-btn"
      data-order-id="{{ order.id }}"
      title="Agregar a seguimiento"
    >
      <span class="star-icon">â˜†</span>
    </button>
  </td>
  <td>
    <button
      type="button"
      class="order-id-link"
      style="
        background: none;
        border: none;
        color: #3b82f6;
        font-weight: 600;
        cursor: pointer;
        text-decoration: underline;
        padding: 0;
      "
      data-order-detail="{{ order.id }}"
      data-table-number="{{ order.session.table_number or '' }}"
      data-customer-name="{{ customer_display_name }}"
      data-customer-email="{{ customer_email }}"
      data-customer-phone="{{ order.customer.phone if order.customer else '' }}"
      data-notes="{{ (order.session.notes or '')|e }}"
      data-waiter-notes="{{ (order.waiter_notes or '')|e }}"
      data-status="{{ status_value }}"
      data-total="{{ order.total_amount }}"
    >
      #{{ order.id }}
    </button>
  </td>
  <td>
    <button
      type="button"
      class="table-number-link"
      style="
        background: none;
        border: none;
        color: #ea580c;
        font-weight: 600;
        cursor: pointer;
        text-decoration: underline;
        padding: 0;
      "
      data-table-info="{{ order.session.table_number or '' }}"
      data-table-number="{{ order.session.table_number or '' }}"
    >
      {{ order.session.table_number or 'N/A' }}
    </button>
  </td>
  <td>{{ customer_display_name }}</td>
  <td>
    {% if order.waiter_name %}
    <span class="waiter-badge">ðŸ‘¤ {{ order.waiter_name }}</span>
    {% else %}
    <span style="color: #9ca3af; font-style: italic">Sin asignar</span>
    {% endif %}
  </td>
  <td style="font-weight: 600">${{ "%.2f"|format(order.total_amount) }}</td>
  <td>
    <span class="status-badge status-{{ status_value }}">
      {{ order.status_display or order.workflow_status }}
    </span>
  </td>
  <td class="time-ago-cell">
    <span class="time-ago" data-timestamp="{{ order.created_at }}"></span>
  </td>
  <td class="actions-cell">{# Actions will be rendered by JavaScript based on order state #}</td>
</tr>
