<!doctype html>
<html lang="es" style="color-scheme: dark">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ restaurant_name|title }} ¬∑ Clientes</title>
  <link rel="stylesheet" href="{{ assets_css_clients }}/main-ux.css" />
  <link rel="stylesheet" href="{{ assets_css_clients }}/qa-fixes.css" />
  <link rel="stylesheet" href="{{ assets_css_clients }}/color-improvements.css" />
  <link rel="stylesheet" href="{{ assets_css_clients }}/qa-error-fixes-updated.css" />
  <link rel="icon" href="{{ restaurant_assets }}/branding/icon.png" type="image/png" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <meta name="csrf-token" content="{{ csrf_token() }}" />
  <!-- <link rel="stylesheet" href="{{ assets_css }}/notifications.css"> -->

  <!-- CRITICAL CSS FIXES - NUCLEAR OPTION -->
  <style id="critical-visual-fixes">
    /* FORCE WHITE BACKGROUND EVERYWHERE */
    html,
    body,
    .menu-page,
    .app-container,
    .main-layout,
    #app,
    .menu-flow {
      background: #ffffff !important;
      background-image: none !important;
      background-color: #ffffff !important;
    }

    /* Remove ALL pseudo-elements that might have gradients */
    *::before,
    *::after {
      background-image: none !important;
    }

    /* FIX FILTER CHIPS - ORANGE NOT BLUE */
    .filter-chip {
      background: #ffffff !important;
      background-image: none !important;
      border: 2px solid #e5e7eb !important;
      color: #374151 !important;
      box-shadow: none !important;
      background: transparent !important;
    }

    .filter-chip[data-active='true'],
    .filter-chip:hover,
    .filter-chip.active {
      background: linear-gradient(135deg, #f97316 0%, #fb923c 100%) !important;
      background-image: linear-gradient(135deg, #f97316 0%, #fb923c 100%) !important;
      border-color: #f97316 !important;
      color: #ffffff !important;
      box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3) !important;
    }

    /* Clean search bar */
    .smart-search__input {
      background: #ffffff !important;
      background-image: none !important;
      border: 2px solid #e5e7eb !important;
    }

    /* Menu sections subtle gray */
    #menu-sections,
    .container {
      background: #f9fafb !important;
      background-image: none !important;
    }

    /* FIX ERROR #1: Make accordion content visible (checkout button parent) */
    .accordion-content {
      opacity: 1 !important;
      visibility: visible !important;
      pointer-events: auto !important;
    }

    /* FIX ERROR #2: Modal overlay should not block form interactions */
    #item-modal .modal-overlay {
      pointer-events: none !important;
    }

    #item-modal .modal-body,
    #item-modal .modal-footer {
      pointer-events: auto !important;
      z-index: 101 !important;
    }

    .modal-add-to-cart,
    .extra-option,
    .modal-quantity-input {
      pointer-events: auto !important;
      z-index: 102 !important;
    }
  </style>

  <style>
    /* Estilos adicionales para la nueva interfaz */
    /* Header & Navigation Redesign */
    .header {
      background: rgba(255, 255, 255, 0.8) !important;
      backdrop-filter: blur(12px) !important;
      -webkit-backdrop-filter: blur(12px) !important;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03) !important;
      position: sticky;
      top: 0;
      z-index: 10000;
      height: 64px;
      display: flex;
      align-items: center;
      border-bottom: 1px solid #f1f5f9 !important;
    }

    .header-container {
      width: 100%;
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 1.25rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo-link {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      text-decoration: none;
      transition: transform 0.2s ease;
    }

    .logo-link:hover {
      transform: scale(1.02);
    }

    .logo-section img {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      object-fit: contain;
      background: white;
      padding: 2px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .brand-name {
      font-size: 1.25rem;
      font-weight: 800;
      color: #0f172a;
      letter-spacing: -0.025em;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .header-btn {
      position: relative;
      background: #f8fafc;
      border: 1px solid #f1f5f9;
      cursor: pointer;
      width: 42px;
      height: 42px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      color: #64748b;
    }

    .header-btn:hover {
      background: #ffffff;
      border-color: #e2e8f0;
      color: #0f172a;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      transform: translateY(-1px);
    }

    .header-btn svg {
      width: 20px;
      height: 20px;
      stroke-width: 2;
    }

    .cart-btn {
      color: #FF6B35;
      background: #fff7ed;
      border-color: #ffedd5;
    }

    .cart-btn:hover {
      background: #ffedd5;
      border-color: #fed7aa;
    }

    .cart-badge {
      position: absolute;
      top: -6px;
      right: -6px;
      background: #ef4444;
      color: white;
      border-radius: 8px;
      min-width: 18px;
      height: 18px;
      padding: 0 4px;
      font-size: 10px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid white;
    }

    .profile-avatar {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      object-fit: cover;
    }

    /* View Tabs Navigation */
    .view-tabs {
      background: #ffffff !important;
      border-bottom: 1px solid #f1f5f9 !important;
      position: sticky;
      top: 64px;
      z-index: 9999;
      padding: 0.5rem 0;
    }

    .view-tabs-container {
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 1.25rem;
      display: flex;
      justify-content: center;
      gap: 0.5rem;
    }

    .view-tab {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.25rem;
      background: transparent;
      border: 2px solid transparent;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.95rem;
      color: #64748b;
      transition: all 0.2s ease;
      white-space: nowrap;
    }

    .view-tab:hover {
      background: #f8fafc;
      color: #0f172a;
    }

    .view-tab.active {
      background: #fff7ed;
      color: #FF6B35;
      border-color: transparent;
    }

    .view-tab__icon {
      font-size: 1.1rem;
    }

    @media (max-width: 640px) {
      .view-tab {
        flex: 1;
        justify-content: center;
        padding: 0.75rem 0.5rem;
      }

      .view-tab__text {
        font-size: 0.85rem;
      }

      .brand-name {
        display: none;
      }
    }

    line-height: 1.4;
    color: var(--text);
    }

    .checkbox-group a {
      color: var(--primary);
      text-decoration: none;
    }

    .checkbox-group a:hover {
      text-decoration: underline;
    }

    /* Forgot Password Link */
    .forgot-password-btn {
      font-size: 0.875rem;
      color: var(--primary);
      background: none;
      border: none;
      padding: 0;
      cursor: pointer;
    }

    .forgot-password-btn:hover {
      text-decoration: underline;
    }

    /* Button Full Width */
    .btn--full {
      width: 100%;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    @keyframes pulse {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.1);
      }
    }

    @keyframes confirmPulse {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.2);
      }

      100% {
        transform: scale(1);
      }
    }

    @keyframes ring {

      0%,
      100% {
        transform: rotate(0deg);
      }

      10%,
      30%,
      50%,
      70%,
      90% {
        transform: rotate(-15deg);
      }

      20%,
      40%,
      60%,
      80% {
        transform: rotate(15deg);
      }
    }

    .cart-badge {
      position: absolute;
      top: 0;
      right: 0;
      background: var(--primary);
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      display: none !important;
    }

    .profile-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid var(--border);
    }

    @media (max-width: 768px) {
      .header-container {
        padding: 0.75rem 1rem;
      }

      .logo-section img {
        width: 45px;
        height: 45px;
      }

      .brand-name {
        font-size: 1.2rem;
      }

      .footer-hours-btn {
        width: 100%;
        justify-content: center;
      }
    }

    /* Active Orders Section - Shared across all pages */
    .active-orders-section {
      background: white;
      border-bottom: 2px solid var(--border);
      position: sticky;
      top: 84px;
      z-index: 85;
    }

    .active-order-card {
      background: white;
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 1rem;
      transition: all 0.3s;
    }

    .active-order-card:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .active-order-card--highlight {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.2);
    }

    .active-order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--border);
    }

    .active-order-status {
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .status-requested {
      background: #fef3c7;
      color: #92400e;
    }

    .status-waiter_accepted {
      background: #dbeafe;
      color: #1e40af;
    }

    .status-kitchen_in_progress {
      background: #fed7aa;
      color: #9a3412;
    }

    .status-ready_for_delivery {
      background: #d1fae5;
      color: #065f46;
    }

    .status-delivered {
      background: #d1fae5;
      color: #065f46;
    }

    .active-order-items {
      margin-top: 0.5rem;
    }

    .active-order-item {
      display: flex;
      justify-content: space-between;
      padding: 0.25rem 0;
      font-size: 0.9rem;
      color: var(--text);
    }

    .active-order-total {
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      font-weight: 700;
      color: var(--primary);
    }

    .view-tabs {
      background: white;
      border-bottom: 2px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 9000;
      display: block;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.06);
    }

    .view-tabs.visible {
      display: block;
    }

    .view-tabs-container {
      width: 100%;
      padding: 0 1.25rem;
      display: flex;
      gap: 0;
    }

    .view-tab {
      padding: 1rem 2rem;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      font-weight: 600;
      font-size: 1rem;
      color: var(--muted);
      transition: all 0.3s;
      position: relative;
    }

    .view-tab:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .view-tab:hover:not(:disabled) {
      color: var(--primary);
      background: var(--background);
    }

    .view-tab.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
    }

    .view-tab .badge {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background: var(--primary);
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 11px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
    }

    .global-loading-overlay {
      position: fixed;
      top: 16px;
      right: 16px;
      width: 64px;
      height: 64px;
      background: rgba(15, 23, 42, 0.92);
      color: #fff;
      border-radius: 18px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.2rem;
      opacity: 0;
      transform: translateY(-10px);
      pointer-events: none;
      transition:
        opacity 0.2s ease,
        transform 0.2s ease;
      z-index: 9999;
      font-size: 0.62rem;
      letter-spacing: 0.03em;
    }

    .global-loading-overlay.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .global-loading-spinner {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top-color: #fff;
      animation: global-loading-spin 0.8s linear infinite;
    }

    @keyframes global-loading-spin {
      to {
        transform: rotate(360deg);
      }
    }

    .footer-hours-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
      color: white;
      border: none;
      border-radius: 999px;
      padding: 0.5rem 1.25rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
      transition:
        transform 0.2s ease,
        box-shadow 0.2s ease;
    }

    .footer-hours-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(37, 99, 235, 0.25);
    }

    #request-check-btn:hover:not(:disabled) {
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.35);
      transform: translateY(-2px);
    }

    #request-check-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .active-orders-headline {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .active-orders-headline span {
      font-size: 0.9rem;
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
    }

    /* Single Order Tracker - Detailed visual progress */
    .single-order-tracker {
      max-width: 800px;
      margin: 2rem auto;
      padding: 2rem;
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
    }

    .tracker-timeline {
      display: flex;
      justify-content: space-between;
      margin: 2rem 0;
      position: relative;
    }

    .tracker-timeline::before {
      content: '';
      position: absolute;
      top: 30px;
      left: 60px;
      right: 60px;
      height: 4px;
      background: var(--border);
      z-index: 0;
    }

    .tracker-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      flex: 1;
      position: relative;
      z-index: 1;
    }

    .tracker-step-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: white;
      border: 4px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      transition: all 0.3s;
    }

    .tracker-step.completed .tracker-step-icon {
      background: var(--primary);
      border-color: var(--primary);
      color: white;
    }

    .tracker-step.active .tracker-step-icon {
      border-color: var(--primary);
      animation: pulse 2s infinite;
    }

    .tracker-step-label {
      text-align: center;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--muted);
    }

    .tracker-step.completed .tracker-step-label,
    .tracker-step.active .tracker-step-label {
      color: var(--primary);
    }

    @keyframes pulse {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.05);
      }
    }

    /* Support Modal */
    .support-link {
      background: none;
      border: none;
      color: var(--primary);
      font-weight: 600;
      cursor: pointer;
      padding: 0;
      margin-left: 0.5rem;
    }

    .support-link:hover {
      text-decoration: underline;
    }

    .support-modal {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1500;
    }

    .support-modal.active {
      display: flex;
    }

    .support-modal-content {
      background: white;
      max-width: 430px;
      width: 90%;
      border-radius: 20px;
      padding: 2rem;
      box-shadow: 0 30px 90px rgba(0, 0, 0, 0.3);
      position: relative;
    }

    .support-modal-content h2 {
      margin: 0 0 0.5rem 0;
      color: var(--text);
    }

    .support-modal-content p {
      margin: 0 0 1.5rem 0;
      color: var(--muted);
    }

    .support-modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      background: none;
      border: none;
      font-size: 1.3rem;
      cursor: pointer;
      color: var(--muted);
    }

    .support-feedback {
      margin-top: 0.75rem;
      font-size: 0.9rem;
      display: none;
    }

    .support-feedback.success {
      color: #0f766e;
      display: block;
    }

    .support-feedback.error {
      color: #b91c1c;
      display: block;
    }

    /* File Upload Styles */
    .file-upload-wrapper {
      position: relative;
      border: 2px dashed var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .file-upload-wrapper:hover {
      border-color: var(--primary);
      background: rgba(255, 107, 53, 0.05);
    }

    .file-upload-wrapper input[type='file'] {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
    }

    .file-upload-placeholder {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      color: var(--muted);
    }

    .file-upload-placeholder svg {
      width: 32px;
      height: 32px;
    }

    .file-upload-placeholder span {
      font-size: 0.875rem;
    }

    .file-upload-preview {
      position: relative;
      display: none;
    }

    .file-upload-preview.show {
      display: block;
    }

    .file-upload-preview img {
      max-width: 100%;
      max-height: 150px;
      border-radius: 8px;
    }

    .remove-image {
      position: absolute;
      top: -8px;
      right: -8px;
      width: 24px;
      height: 24px;
      background: #ef4444;
      color: white;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1rem;
      line-height: 1;
    }

    /* Support Success State */
    .support-success {
      text-align: center;
      padding: 1rem 0;
    }

    .support-success.show {
      display: block;
    }

    .support-success-icon {
      width: 64px;
      height: 64px;
      background: #d1fae5;
      color: #10b981;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      margin: 0 auto 1rem;
    }

    .support-success h3 {
      margin: 0 0 0.5rem 0;
      color: var(--text);
    }

    .support-success p {
      color: var(--muted);
      margin: 0 0 1rem 0;
    }

    .support-success strong {
      color: var(--primary);
      font-size: 1.25rem;
    }
  </style>
  <script id="qa-fixes-injection">
    // Immediate injection - runs before anything else
    (function () {
      function applyFixes() {
        // Force button to be visible
        const btnSelector = [
          'button#checkout-submit-btn',
          '.checkout-submit-btn',
          'button[form="checkout-form"]',
        ];
        for (const sel of btnSelector) {
          const btn = document.querySelector(sel);
          if (btn) {
            btn.style.cssText = `
              width: 100% !important;
              height: 3rem !important;
              min-height: 3rem !important;
              display: inline-flex !important;
              opacity: 1 !important;
              visibility: visible !important;
              pointer-events: auto !important;
              cursor: pointer !important;
              flex-direction: row !important;
              align-items: center !important;
              justify-content: center !important;
              padding: 1rem !important;
              margin-top: 1rem !important;
              box-sizing: border-box !important;
              position: relative !important;
              float: none !important;
            `;
          }
        }

        // Force accordion content visible
        document.querySelectorAll('.accordion-content').forEach((el) => {
          el.style.cssText = `
            opacity: 1 !important;
            visibility: visible !important;
            pointer-events: auto !important;
            display: block !important;
            width: 100% !important;
          `;
        });
      }

      applyFixes();
      document.addEventListener('DOMContentLoaded', applyFixes);
      window.addEventListener('load', applyFixes);

      // Re-run every 100ms for first 10 seconds
      let count = 0;
      const fixInterval = setInterval(() => {
        applyFixes();
        count++;
        if (count >= 100) clearInterval(fixInterval);
      }, 100);
    })();
  </script>
  <!-- FINAL CSS OVERRIDE - LOADED LAST, HIGHEST PRIORITY -->
  <style id="qa-error-fixes-final">
    /* Override all checkout button styling */
    button#checkout-submit-btn,
    .checkout-submit-btn,
    button[form='checkout-form'],
    button[form='checkout-form'].checkout-submit-btn {
      width: 100% !important;
      height: 3rem !important;
      min-height: 3rem !important;
      display: inline-flex !important;
      opacity: 1 !important;
      visibility: visible !important;
      pointer-events: auto !important;
      cursor: pointer !important;
    }

    /* Override accordion content */
    .accordion-content {
      opacity: 1 !important;
      visibility: visible !important;
      pointer-events: auto !important;
      display: block !important;
    }
  </style>
  <script>
    window.APP_SETTINGS = {{ app_settings | tojson | safe }};
    window.APP_CONFIG = {
      'app_name': '{{ app_name }}',
      'restaurant_name': '{{ restaurant_name }}',
      'restaurant_assets': '{{ restaurant_assets }}',
      'static_host_url': '{{ static_host_url }}',
      'current_year': '{{ current_year }}',
      'debug_mode': '{{ debug_mode }}' === 'True',
      'server_time': '{{ server_time }}'
    };
  </script>
  {% if customer_data is defined %}
  <script>
    window.APP_SESSION = { customer: {{ customer_data | tojson | safe }} };
  </script>
  {% endif %}
</head>

<body>
  <!-- FIX APPLIED: PROFILE MODAL CSS MOVED -->
  <div class="global-loading-overlay" id="global-loading" role="status" aria-live="polite">
    <div class="global-loading-spinner"></div>
    <span>Cargando</span>
  </div>
  <div class="notification-container" id="notification-container"></div>

  <!-- Profile Modal -->
  <div class="profile-modal" id="profile-modal">
    <div class="profile-modal-overlay"></div>
    <div class="profile-modal-content">
      <button class="profile-modal-close">√ó</button>

      <!-- Not Logged In View -->
      <div id="profile-not-logged-in" class="profile-view">
        <div class="profile-header">
          <h2>Bienvenido a Pronto</h2>
          <p style="color: var(--muted); margin-top: 0.5rem">
            Inicia sesi√≥n o reg√≠strate para guardar tus pedidos
          </p>
        </div>

        <div class="profile-tabs">
          <button class="profile-tab active" data-tab="login">Iniciar Sesi√≥n</button>
          <button class="profile-tab" data-tab="register">Registrarse</button>
        </div>

        <!-- Login Form -->
        <form id="login-form" class="profile-form">
          <div class="form-group">
            <label for="login-email">Correo electr√≥nico</label>
            <input type="email" id="login-email" required autocomplete="email" />
          </div>
          <div class="form-group">
            <label for="login-password">Contrase√±a</label>
            <div class="password-input-wrapper">
              <input type="password" id="login-password" required autocomplete="current-password" />
              <button type="button" class="password-toggle" aria-label="Mostrar contrase√±a">
                <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
                <svg class="eye-slash-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                  style="display: none">
                  <path
                    d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24">
                  </path>
                  <line x1="1" y1="1" x2="23" y2="23"></line>
                </svg>
              </button>
            </div>
          </div>
          <button type="submit" class="btn btn-primary btn--full">Iniciar Sesi√≥n</button>
          <button type="button" class="btn btn-link forgot-password-btn" id="forgot-password-btn"
            style="margin-top: 1rem; align-self: flex-start">
            ¬øOlvidaste tu contrase√±a?
          </button>
          <div class="form-feedback" id="login-feedback"></div>
        </form>

        <!-- Register Form -->
        <form id="register-form" class="profile-form" style="display: none">
          <div class="form-group">
            <label for="register-name">Nombre completo para teclear</label>
            <input type="text" id="register-name" placeholder="Ej: Juan P√©rez Garc√≠a" required autocomplete="name" />
          </div>
          <div class="form-group">
            <label for="register-email">Correo electr√≥nico</label>
            <input type="email" id="register-email" placeholder="tu@email.com" required autocomplete="email" />
          </div>
          <div class="form-group">
            <label for="register-phone">Tel√©fono celular</label>
            <div class="phone-input-container">
              <div class="country-code-selector">
                <span class="flag-icon">üá≤üáΩ</span>
                <span class="country-code">+52</span>
              </div>
              <input type="tel" id="register-phone" placeholder="5512345678" maxlength="10" pattern="[0-9]{10}" required
                autocomplete="tel" />
            </div>
            <small style="color: var(--muted); font-size: 0.85rem; margin-top: 0.25rem; display: block">10 d√≠gitos sin
              espacios</small>
          </div>
          <div class="form-group">
            <label for="register-password">Contrase√±a</label>
            <div class="password-input-wrapper">
              <input type="password" id="register-password" placeholder="M√≠nimo 6 caracteres" required minlength="6"
                autocomplete="new-password" />
              <button type="button" class="password-toggle" aria-label="Mostrar contrase√±a">
                <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
                <svg class="eye-slash-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                  style="display: none">
                  <path
                    d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24">
                  </path>
                  <line x1="1" y1="1" x2="23" y2="23"></line>
                </svg>
              </button>
            </div>
            <div class="password-strength">
              <div class="password-strength-bar" id="password-strength-bar"></div>
            </div>
            <div class="password-requirements" id="password-requirements">
              <span class="req" data-req="length">M√≠nimo 6 caracteres</span>
              <span class="req" data-req="number">Un n√∫mero</span>
              <span class="req" data-req="uppercase">Una may√∫scula</span>
            </div>
          </div>
          <div class="form-group checkbox-group">
            <input type="checkbox" id="accept-terms" required />
            <label for="accept-terms">
              Acepto los <a href="#" target="_blank">T√©rminos de Servicio</a> y
              <a href="#" target="_blank">Pol√≠tica de Privacidad</a>
            </label>
          </div>
          <button type="submit" class="btn btn-primary btn--full" id="register-submit-btn" disabled>
            Crear Cuenta
          </button>
          <div class="form-feedback" id="register-feedback"></div>
        </form>
      </div>

      <!-- Logged In View -->
      <div id="profile-logged-in" class="profile-view" style="display: none">
        <div class="profile-header">
          <img id="profile-modal-avatar" class="profile-modal-avatar" src="" alt="" />
          <h2 id="profile-name">Usuario</h2>
          <p id="profile-email" style="color: var(--muted)"></p>
        </div>

        <div class="profile-menu">
          <button class="profile-menu-item" data-profile-action="orders">
            <span>üìã</span>
            <span>Mis Pedidos</span>
          </button>
          <button class="profile-menu-item" data-profile-action="settings">
            <span>‚öôÔ∏è</span>
            <span>Configuraci√≥n</span>
          </button>
          <button class="profile-menu-item" data-profile-action="logout">
            <span>üö™</span>
            <span>Cerrar Sesi√≥n</span>
          </button>
        </div>
      </div>
    </div>
  </div>
  <header class="header">
    <div class="header-container">
      <div class="logo-section">
        <a href="/" class="logo-link">
          <img src="{{ restaurant_assets }}/branding/logo.png" alt="{{ restaurant_name }} logo"
            onload="this.classList.add('loaded')" onerror="
                this.classList.add('loaded');
                this.src =
                  'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Ccircle cx=%2250%22 cy=%2250%22 r=%2240%22 fill=%22%23ff6b35%22/%3E%3Ctext x=%2250%22 y=%2260%22 text-anchor=%22middle%22 font-size=%2240%22 fill=%22white%22 font-family=%22sans-serif%22%3EQ%3C/text%3E%3C/svg%3E';
              " />
          <span class="brand-name">{{ restaurant_name|title }}</span>
        </a>
      </div>
      <div class="header-actions">
        <button class="header-btn waiter-btn" aria-label="Llamar al mesero" title="Llamar al mesero">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
          </svg>
        </button>
        <button class="header-btn cart-btn" data-toggle-cart aria-label="Ver carrito" title="Ver carrito">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
          </svg>
          <span class="cart-badge" id="cart-count">0</span>
        </button>
        <button class="header-btn profile-btn" aria-label="Mi perfil" title="Mi perfil">
          <img class="profile-avatar" id="profile-avatar"
            src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%23e2e8f0'/%3E%3Cpath d='M50 45a15 15 0 100-30 15 15 0 000 30zM25 85c0-13.8 11.2-25 25-25s25 11.2 25 25' fill='%236b7280'/%3E%3C/svg%3E"
            alt="Foto de perfil" />
        </button>
      </div>
    </div>
  </header>

  <!-- View Tabs - Switch between Menu and My Orders -->
  <div class="view-tabs sticky-nav" id="view-tabs">
    <div class="view-tabs-container">
      <button class="view-tab active" id="tab-menu">
        <i data-lucide="utensils" class="view-tab__icon"></i>
        <span class="view-tab__text">Men√∫</span>
      </button>
      <button class="view-tab" id="tab-details">
        <i data-lucide="clipboard-list" class="view-tab__icon"></i>
        <span class="view-tab__text">Detalles</span>
      </button>
      <button class="view-tab" id="tab-orders">
        <i data-lucide="clipboard-check" class="view-tab__icon"></i>
        <span class="view-tab__text">√ìrdenes</span>
        <span class="badge badge--hidden" id="orders-badge">0</span>
      </button>
    </div>
  </div>

  <!-- Active Orders Section - Shows when viewing orders -->
  <div class="active-orders-section" id="active-orders-section">
    <!-- Single Order Tracker (se usa como modal de detalle) -->
    <div class="single-order-tracker" id="single-order-tracker"></div>

    <!-- Multiple Orders Grid - Shows when there are 2+ orders -->
    <div class="multiple-orders-view" id="multiple-orders-view">
      <div class="multiple-orders-view__header">
        <div class="active-orders-headline">
          <h2>√ìrdenes Activas</h2>
          <span>‚è±Ô∏è Se actualiza autom√°ticamente cada 10 segundos</span>
        </div>
      </div>
      <div class="active-orders-list" id="active-orders-list">
        <!-- Orders will be dynamically inserted here -->
      </div>
    </div>

    <!-- Modal de detalle -->
    <div class="order-detail-modal" id="order-detail-modal">
      <div class="order-detail-content" id="order-detail-content">
        <button class="order-detail-close" id="close-order-detail">‚úï</button>
        <div id="order-detail-body"></div>
      </div>
    </div>
  </div>

  <!-- Checkout Section (Detalles Tab) - Hidden by default -->
  <div class="checkout-section" id="checkout-section" style="display: none">
    <div class="checkout-shell">
      <!-- Checkout Accordion Layout -->
      <style>
        /* Accordion Styles for Checkout Tab */
        .checkout-accordion-list {
          display: flex;
          flex-direction: column;
          gap: 1rem;
          padding-bottom: 2rem;
        }

        .checkout-accordion {
          background: var(--card-bg, #fff);
          border: 1px solid var(--border-color, #e5e7eb);
          border-radius: 12px;
          overflow: hidden;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
          transition: all 0.3s ease;
        }

        .checkout-accordion.collapsed .accordion-content {
          display: none;
        }

        .checkout-accordion-header {
          padding: 1rem 1.25rem;
          display: flex;
          justify-content: space-between;
          align-items: center;
          cursor: pointer;
          background: var(--bg-surface, #fff);
          /* border-bottom is added only if expanded */
        }

        .checkout-accordion:not(.collapsed) .checkout-accordion-header {
          border-bottom: 1px solid var(--border-color, #e5e7eb);
          background: var(--bg-secondary, #f9fafb);
        }

        .accordion-title {
          font-weight: 600;
          font-size: 1.05rem;
          display: flex;
          align-items: center;
          gap: 0.75rem;
          color: var(--text-primary, #111827);
        }

        .accordion-icon {
          font-size: 1.2rem;
        }

        .accordion-chevron {
          transition: transform 0.3s ease;
          color: var(--text-tertiary, #9ca3af);
        }

        .checkout-accordion:not(.collapsed) .accordion-chevron {
          transform: rotate(180deg);
        }

        .accordion-content {
          padding: 1.25rem;
          background: var(--card-bg, #fff);
          animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
          from {
            opacity: 0;
            transform: translateY(-10px);
          }

          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        .header-status {
          font-size: 0.75rem;
          padding: 0.25rem 0.6rem;
          border-radius: 999px;
          background: #f3f4f6;
          color: #4b5563;
          font-weight: 500;
          margin-right: 0.75rem;
        }

        .header-status.new {
          background: #dbeafe;
          color: #1e40af;
        }

        .header-status.confirmed {
          background: #dcfce7;
          color: #166534;
        }
      </style>

      <div class="checkout-accordion-list" id="checkout-accordions">
        <!-- 1. Customer Info Accordion -->
        <div class="checkout-accordion" id="accordion-customer">
          <div class="checkout-accordion-header" onclick="this.parentElement.classList.toggle('collapsed')">
            <div class="accordion-title">
              <div class="header-btn-icon">
                <!-- Avatar -->
                <img src="{{ static_host_url }}/assets/images/default-avatar.png" alt="Profile" />
              </div>
              <span>Datos del Cliente</span>
            </div>
            <div style="display: flex; align-items: center">
              <span class="header-status" id="customer-status-badge">Requerido</span>
              <span class="accordion-chevron">‚ñº</span>
            </div>
          </div>
          <div class="accordion-content">
            <p style="margin-bottom: 1rem; color: var(--text-secondary, #6b7280); font-size: 0.9em">
              Ingresa tus datos para contactarte cuando el pedido est√© listo.
            </p>
            <form id="checkout-form" novalidate>
              <div class="form-group">
                <label for="customer-name">Nombre <span class="label-hint">(opcional)</span></label>
                <input type="text" id="customer-name" name="name" placeholder="Tu nombre" maxlength="100"
                  autocomplete="name" />
                <span class="form-group__status" id="customer-name-status"></span>
                <span class="form-group__error" id="customer-name-error"></span>
              </div>

              <div class="form-group">
                <label for="customer-email">Email
                  <span class="required-indicator" style="color: var(--danger, #e74c3c)">*</span>
                  <small class="text-muted" style="color: var(--muted); display: block; margin-top: 4px">Requerido para
                    env√≠o de ticket</small>
                </label>
                <input type="email" id="customer-email" name="email" placeholder="tu@email.com" maxlength="254"
                  autocomplete="email" required />
                <span class="form-group__status" id="customer-email-status"></span>
                <span class="form-group__error" id="customer-email-error"></span>
              </div>

              <div class="form-group">
                <label for="customer-phone">Tel√©fono <span class="label-hint">(opcional)</span></label>
                <div class="phone-input-group">
                  <select id="phone-country-code" class="phone-country-select" style="max-width: 80px"></select>
                  <input type="tel" id="customer-phone" name="phone" placeholder="N√∫mero celular" maxlength="15"
                    autocomplete="tel" />
                </div>
                <span class="form-group__status" id="customer-phone-status"></span>
                <span class="form-group__error" id="customer-phone-error"></span>
              </div>

              <div class="mesa-info-card" style="
                    margin-top: 1rem;
                    border: 1px solid #e5e7eb;
                    padding: 1rem;
                    border-radius: 8px;
                  ">
                <div class="mesa-info-card__content">
                  <h4 class="mesa-info-card__title" id="table-label" style="margin: 0">Mesa ‚Äî</h4>
                  <input type="hidden" id="table-number" name="table_number" />
                </div>
              </div>

              <div class="form-group" style="margin-top: 1rem">
                <label for="notes">Notas especiales</label>
                <textarea id="notes" name="notes" rows="3" placeholder="Alergias, preferencias..."
                  maxlength="500"></textarea>
                <span class="form-group__counter" id="notes-counter" style="font-size: 0.8em; float: right">0/500</span>
              </div>

              <div class="feedback-message" id="checkout-feedback"></div>
            </form>
          </div>
        </div>

        <!-- 2. History of Session Orders (Dynamic) -->
        <div id="checkout-history-container">
          <!-- Rendered via JS -->
        </div>

        <!-- 3. Current Cart Accordion -->
        <div class="checkout-accordion expanded" id="accordion-current-order">
          <div class="checkout-accordion-header" onclick="this.parentElement.classList.toggle('collapsed')">
            <div class="accordion-title">
              <span class="accordion-icon">üõí</span>
              <span>Orden Actual</span>
            </div>
            <div style="display: flex; align-items: center">
              <span class="header-status new">Por Confirmar</span>
              <span class="accordion-chevron">‚ñº</span>
            </div>
          </div>
          <div class="accordion-content">
            <!-- Cart Items Summary -->
            <div class="checkout-summary-header" style="margin-bottom: 1rem">
              <h3 class="checkout-summary__title" style="font-size: 1rem">Resumen del Pedido</h3>
              <span class="checkout-summary__badge" id="cart-items-count">0 items</span>
            </div>

            <div class="checkout-summary__items" id="checkout-summary"></div>

            <div class="checkout-summary__divider"></div>

            <div class="checkout-summary__total">
              <span class="checkout-summary__total-label">Total a Pagar</span>
              <span class="checkout-summary__total-amount" id="checkout-total">$0.00</span>
            </div>

            <button type="submit" form="checkout-form" class="checkout-submit-btn" id="checkout-submit-btn">
              Confirmar Pedido
            </button>

            <p class="checkout-summary__secure"
              style="text-align: center; margin-top: 1rem; font-size: 0.8rem; color: gray">
              üîí Confirmaci√≥n instant√°nea
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Account Details Section - Shows when viewing account summary -->
  <div class="account-details-section" id="account-details-section">
    <div class="account-details-container">
      <div class="account-details-header">
        <div>
          <h2 class="account-details-title">üí≥ Resumen de Cuenta</h2>
          <p class="account-details-subtitle">Detalles completos de tu sesi√≥n</p>
        </div>
      </div>
      <div id="account-details-content">
        <!-- Account details will be dynamically inserted here -->
      </div>
    </div>
  </div>

  <main>{% block content %}{% endblock %}</main>

  <!-- Cart Panel Block (outside main so it's accessible in all views) -->
  {% block cart_panel %}{% endblock %}

  <!-- Mini Order Tracker (shown when there's an active order) - Global across all pages -->
  <div class="mini-tracker" id="mini-tracker">
    <button class="mini-tracker-close" id="mini-tracker-close" aria-label="Cerrar tracker" title="Ocultar tracker">
      √ó
    </button>
    <div class="mini-tracker-content">
      <div class="mini-tracker-left">
        <div class="mini-tracker-icon">üçΩÔ∏è</div>
        <div class="mini-tracker-info">
          <div class="mini-tracker-title">Tu pedido</div>
          <div class="mini-tracker-status" id="mini-tracker-status">Preparando...</div>
        </div>
      </div>
      <div class="mini-tracker-right">
        <div class="mini-tracker-order-select" id="mini-tracker-order-select-wrapper">
          <label for="mini-tracker-order-select">Orden</label>
          <select id="mini-tracker-order-select"></select>
        </div>
        <div class="mini-tracker-progress-container" id="mini-tracker-progress-container">
          <div class="mini-tracker-progress-bar">
            <div class="mini-tracker-progress-fill" id="mini-tracker-progress"></div>
          </div>
          <div class="mini-tracker-percentage" id="mini-tracker-percentage">0%</div>
        </div>
        <button class="mini-tracker-btn" id="view-detail-btn" onclick="viewFullTracker()">
          Ver detalle
        </button>
        <button class="mini-tracker-btn mini-tracker-btn--primary" id="request-checkout-btn" style="display: none"
          onclick="requestCheckoutFromTracker()">
          üí≥ Pedir Cuenta
        </button>
      </div>
    </div>
  </div>

  <footer class="footer">
    <div class="footer-container">
      <!-- Business Hours Display -->
      <div class="business-hours-display" id="business-hours-display">
        <h3 class="business-hours-title">‚è∞ Horarios de Atenci√≥n</h3>
        <div class="business-hours-schedule" id="business-hours-schedule">
          <!-- Schedule will be populated by JavaScript -->
        </div>
        <div class="business-hours-status" id="current-status">
          <!-- Current status will be populated by JavaScript -->
        </div>
      </div>

      <div class="footer-hours-actions">
        <button type="button" class="footer-hours-btn" id="footer-hours-btn">
          üïí Ver horarios de atenci√≥n
        </button>
      </div>

      <p class="footer-copyright">
        &copy; {{ restaurant_name|title }} {{ current_year }} ¬∑ Hecho con pasi√≥n
        <button type="button" class="support-link" data-open-support>Soporte t√©cnico</button>
      </p>
    </div>
  </footer>

  <!-- Outside Business Hours Modal -->
  <div class="outside-hours-modal" id="outside-hours-modal">
    <div class="outside-hours-modal-content">
      <h2 style="margin: 0 0 1rem 0; color: var(--text); font-size: 1.5rem">
        üïê Fuera de Horario
      </h2>
      <p style="margin: 0 0 1.5rem 0; color: var(--muted); line-height: 1.6">
        Actualmente nos encontramos fuera de nuestro horario de atenci√≥n. Puedes ver nuestro men√∫,
        pero los pedidos no ser√°n procesados hasta que abramos.
      </p>
      <div id="outside-hours-schedule"
        style="background: #f8fafc; border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem">
        <!-- Schedule will be populated by JavaScript -->
      </div>
      <button type="button" class="btn btn-primary outside-hours-continue-btn" id="outside-hours-continue-btn">
        Continuar de todos modos
      </button>
    </div>
  </div>

  <!-- All outside-hours styles moved to menu.css for better maintainability -->

  <!-- Support Modal -->
  <div class="support-modal" id="support-modal">
    <div class="support-modal-content">
      <button class="support-modal-close" id="support-modal-close">√ó</button>
      <h2>Soporte t√©cnico</h2>
      <p>Cu√©ntanos qu√© problema encontraste y te contactaremos.</p>
      <form id="support-form">
        <div class="form-group">
          <label for="support-category">Categor√≠a del problema</label>
          <select id="support-category" required>
            <option value="">Selecciona una categor√≠a</option>
            <option value="order">Problema con un pedido</option>
            <option value="payment">Problema de pago</option>
            <option value="product">Producto incorrecto o faltante</option>
            <option value="delivery">Problema de entrega</option>
            <option value="account">Problema con mi cuenta</option>
            <option value="technical">Error t√©cnico en la app</option>
            <option value="suggestion">Sugerencia o comentario</option>
            <option value="other">Otro</option>
          </select>
        </div>
        <div class="form-group">
          <label for="support-name">Nombre</label>
          <input type="text" id="support-name" required placeholder="Tu nombre" />
        </div>
        <div class="form-group">
          <label for="support-email">Correo</label>
          <input type="email" id="support-email" required placeholder="tu@email.com" />
        </div>
        <div class="form-group">
          <label for="support-description">¬øQu√© sucedi√≥?</label>
          <textarea id="support-description" rows="4" required
            placeholder="Describe el problema con detalle..."></textarea>
        </div>
        <div class="form-group">
          <label for="support-image">Adjuntar imagen (opcional)</label>
          <div class="file-upload-wrapper">
            <input type="file" id="support-image" accept="image/*" capture="environment" />
            <div class="file-upload-preview" id="support-image-preview" style="display: none">
              <img id="support-image-img" src="" alt="Vista previa" />
              <button type="button" class="remove-image" id="remove-support-image">√ó</button>
            </div>
            <div class="file-upload-placeholder" id="support-image-placeholder">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
              </svg>
              <span>Toma una foto o selecciona</span>
            </div>
          </div>
        </div>
        <input type="hidden" id="support-page-url" />
        <button type="submit" class="btn btn-primary btn--full">Enviar reporte</button>
        <div class="support-feedback" id="support-feedback"></div>
      </form>
      <div class="support-success" id="support-success" style="display: none">
        <div class="support-success-icon">‚úì</div>
        <h3>¬°Reporte enviado!</h3>
        <p>Tu n√∫mero de ticket es: <strong id="support-ticket-number"></strong></p>
        <p>Te contactaremos a <span id="support-confirm-email"></span> en breve.</p>
        <button type="button" class="btn btn-secondary" id="support-close-btn">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Password Recovery Modal -->
  <div class="password-recovery-modal" id="password-recovery-modal">
    <div class="password-recovery-modal-overlay"></div>
    <div class="password-recovery-modal-content">
      <button class="password-recovery-modal-close" id="password-recovery-close">√ó</button>

      <!-- Step 1: Request Recovery -->
      <div id="password-recovery-step-1" class="password-recovery-step">
        <div class="password-recovery-header">
          <h2>¬øOlvidaste tu contrase√±a?</h2>
          <p style="color: var(--muted); margin-top: 0.5rem">
            Ingresa tu email y te enviaremos un enlace para restablecerla
          </p>
        </div>

        <form id="password-recovery-form">
          <div class="form-group">
            <label for="recovery-email">Correo electr√≥nico</label>
            <input type="email" id="recovery-email" placeholder="tu@email.com" required autocomplete="email" />
          </div>
          <button type="submit" class="btn btn-primary btn--full" id="recovery-submit-btn">
            Enviar enlace de recuperaci√≥n
          </button>
          <div class="form-feedback" id="recovery-feedback"></div>
        </form>

        <div class="password-recovery-footer">
          <button class="btn btn-ghost btn--full" id="back-to-login-btn">
            ‚Üê Volver a iniciar sesi√≥n
          </button>
        </div>
      </div>

      <!-- Step 2: Success Message -->
      <div id="password-recovery-step-2" class="password-recovery-step" style="display: none">
        <div class="password-recovery-success">
          <div class="password-recovery-success-icon">‚úì</div>
          <h3>¬°Enlace enviado!</h3>
          <p style="color: var(--muted)">
            Si el correo electr√≥nico est√° registrado, recibir√°s un enlace para restablecer tu
            contrase√±a.
          </p>
          <button class="btn btn-secondary btn--full" id="recovery-done-btn">Entendido</button>
        </div>
      </div>

      <!-- Step 3: Reset Password (for when user clicks link) -->
      <div id="password-recovery-step-3" class="password-recovery-step" style="display: none">
        <div class="password-recovery-header">
          <h2>Nueva contrase√±a</h2>
          <p style="color: var(--muted); margin-top: 0.5rem">Ingresa tu nueva contrase√±a</p>
        </div>

        <form id="password-reset-form">
          <div class="form-group">
            <label for="reset-password">Nueva contrase√±a</label>
            <div class="password-input-wrapper">
              <input type="password" id="reset-password" placeholder="M√≠nimo 6 caracteres" required minlength="6"
                autocomplete="new-password" />
              <button type="button" class="password-toggle" aria-label="Mostrar contrase√±a">
                <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
                <svg class="eye-slash-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                  style="display: none">
                  <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94"></path>
                  <line x1="1" y1="1" x2="23" y2="23"></line>
                </svg>
              </button>
            </div>
            <div class="password-strength">
              <div class="password-strength-bar" id="reset-password-strength-bar"></div>
            </div>
          </div>
          <div class="form-group">
            <label for="reset-password-confirm">Confirmar contrase√±a</label>
            <input type="password" id="reset-password-confirm" placeholder="Repite tu contrase√±a" required
              autocomplete="new-password" />
          </div>
          <button type="submit" class="btn btn-primary btn--full" id="reset-submit-btn">
            Cambiar contrase√±a
          </button>
          <div class="form-feedback" id="reset-feedback"></div>
        </form>
      </div>

      <!-- Step 4: Reset Success -->
      <div id="password-recovery-step-4" class="password-recovery-step" style="display: none">
        <div class="password-recovery-success">
          <div class="password-recovery-success-icon">‚úì</div>
          <h3>¬°Contrase√±a actualizada!</h3>
          <p style="color: var(--muted)">Tu contrase√±a ha sido cambiada exitosamente.</p>
          <button class="btn btn-primary btn--full" id="reset-success-btn">Iniciar sesi√≥n</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Order History Modal -->
  <div class="order-history-modal" id="order-history-modal">
    <div class="order-history-modal-overlay"></div>
    <div class="order-history-modal-content">
      <button class="order-history-modal-close" id="order-history-close">√ó</button>

      <div class="order-history-header">
        <h2>Mis Pedidos</h2>
        <div class="order-history-tabs">
          <button class="order-history-tab active" data-status="all">Todos</button>
          <button class="order-history-tab" data-status="active">Activos</button>
          <button class="order-history-tab" data-status="completed">Completados</button>
        </div>
      </div>

      <div class="order-history-content" id="order-history-content">
        <div class="order-history-loading" id="order-history-loading" style="display: none">
          <div class="spinner"></div>
          <p>Cargando pedidos...</p>
        </div>
        <div class="order-history-empty" id="order-history-empty" style="display: none">
          <svg class="empty-state-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path
              d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
          </svg>
          <h3 class="empty-state-title">Sin pedidos a√∫n</h3>
          <p class="empty-state-description">
            Tus pedidos aparecer√°n aqu√≠ despu√©s de realizar uno.
          </p>
          <button class="btn btn-primary" onclick="backToMenu()">Ver men√∫</button>
        </div>
        <div class="order-history-list" id="order-history-list"></div>
      </div>
    </div>
  </div>

  <style>
    .profile-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 10001;
      /* Fix: Ensure modal is above header (z-index 10000) */
      animation: fadeIn 0.2s ease;
    }

    .profile-modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .profile-modal-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
    }

    .profile-modal-content {
      position: relative;
      background: white;
      border-radius: 16px;
      padding: 2rem;
      max-width: 450px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.3s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    @keyframes slideUp {
      from {
        transform: translateY(20px);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .profile-modal-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      font-size: 2rem;
      color: var(--muted);
      cursor: pointer;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.2s;
    }

    .profile-modal-close:hover {
      background: var(--background);
      color: var(--text);
    }

    .profile-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .profile-header h2 {
      margin: 0;
      color: var(--text);
      font-size: 1.5rem;
    }

    .profile-tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      background: var(--background);
      padding: 0.25rem;
      border-radius: 12px;
    }

    .profile-tab {
      flex: 1;
      padding: 0.75rem;
      border: none;
      background: transparent;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      color: var(--muted);
      transition: all 0.2s;
    }

    .profile-tab.active {
      background: white;
      color: var(--primary);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .profile-form {
      animation: fadeIn 0.2s ease;
    }

    .form-group {
      margin-bottom: 1.25rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--text);
      font-size: 0.9rem;
    }

    .form-group input {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid var(--border);
      border-radius: 10px;
      font-size: 1rem;
      transition: border-color 0.2s;
      box-sizing: border-box;
    }

    .form-group input:focus-visible {
      outline: none;
      border-color: var(--primary);
    }

    .btn {
      width: 100%;
      padding: 1rem;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: linear-gradient(135deg, #ff6b35, #ff8c42);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255, 107, 53, 0.3);
    }

    .form-feedback {
      margin-top: 1rem;
      padding: 0.75rem;
      border-radius: 8px;
      font-size: 0.9rem;
      display: none;
    }

    .form-feedback.success {
      display: block;
      background: #d1fae5;
      color: #065f46;
    }

    .form-feedback.error {
      display: block;
      background: #fee2e2;
      color: #991b1b;
    }

    .profile-modal-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      margin: 0 auto 1rem;
      border: 3px solid var(--primary);
      display: block;
    }

    .profile-menu {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-top: 2rem;
    }

    .profile-menu-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      border: 2px solid var(--border);
      background: white;
      border-radius: 10px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      color: var(--text);
      transition: all 0.2s;
    }

    /* Password Recovery Modal Styles */
    .password-recovery-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 2000;
      animation: fadeIn 0.2s ease;
    }

    .password-recovery-modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .password-recovery-modal-overlay {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
    }

    .password-recovery-modal-content {
      position: relative;
      background: white;
      max-width: 420px;
      width: 90%;
      border-radius: 16px;
      padding: 2rem;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.3s ease;
    }

    .password-recovery-modal-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      width: 36px;
      height: 36px;
      background: var(--surface);
      border: none;
      border-radius: 50%;
      font-size: 1.5rem;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s;
    }

    .password-recovery-modal-close:hover {
      background: var(--border);
      color: var(--text);
    }

    .password-recovery-header h2 {
      margin: 0 0 0.5rem 0;
      font-size: 1.5rem;
      color: var(--text-primary);
    }

    .password-recovery-footer {
      margin-top: 1.5rem;
      text-align: center;
    }

    .password-recovery-success {
      text-align: center;
      padding: 1rem 0;
    }

    .password-recovery-success-icon {
      width: 72px;
      height: 72px;
      background: var(--color-success-light);
      color: var(--color-success);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      margin: 0 auto 1.5rem;
    }

    .password-recovery-success h3 {
      margin: 0 0 0.75rem 0;
      font-size: 1.5rem;
      color: var(--text-primary);
    }

    .password-recovery-success p {
      color: var(--text-secondary);
      margin: 0 0 1.5rem 0;
    }

    /* Order History Modal Styles */
    .order-history-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 2000;
      animation: fadeIn 0.2s ease;
    }

    .order-history-modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .order-history-modal-overlay {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
    }

    .order-history-modal-content {
      position: relative;
      background: white;
      max-width: 600px;
      width: 95%;
      max-height: 80vh;
      border-radius: 16px;
      padding: 1.5rem;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.3s ease;
      display: flex;
      flex-direction: column;
    }

    .order-history-modal-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      width: 36px;
      height: 36px;
      background: var(--color-surface);
      border: none;
      border-radius: 50%;
      font-size: 1.5rem;
      color: var(--color-text-secondary);
      cursor: pointer;
      transition: all 0.2s;
      z-index: 1;
    }

    .order-history-modal-close:hover {
      background: var(--color-border);
      color: var(--color-text-primary);
    }

    .order-history-header {
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--color-border);
    }

    .order-history-header h2 {
      margin: 0 0 1rem 0;
      font-size: 1.5rem;
      color: var(--color-text-primary);
    }

    .order-history-tabs {
      display: flex;
      gap: 0.5rem;
    }

    .order-history-tab {
      padding: 0.5rem 1rem;
      background: var(--color-surface);
      border: 2px solid transparent;
      border-radius: 20px;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--color-text-secondary);
      cursor: pointer;
      transition: all 0.2s;
    }

    .order-history-tab:hover {
      background: var(--color-primary-light);
      color: var(--color-primary);
    }

    .order-history-tab.active {
      background: var(--color-primary);
      color: white;
      border-color: var(--color-primary);
    }

    .order-history-content {
      flex: 1;
      overflow-y: auto;
      min-height: 200px;
      max-height: calc(80vh - 150px);
    }

    .order-history-loading,
    .order-history-empty {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 3rem;
      text-align: center;
    }

    .order-history-empty .empty-state-icon {
      width: 64px;
      height: 64px;
      margin-bottom: 1rem;
      color: var(--color-text-tertiary);
    }

    .order-history-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .order-card {
      background: var(--color-surface);
      border-radius: 12px;
      padding: 1rem;
      transition: all 0.2s;
    }

    .order-card:hover {
      background: var(--color-primary-light);
    }

    .order-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.75rem;
    }

    .order-card-id {
      font-size: 1rem;
      font-weight: 700;
      color: var(--color-text-primary);
    }

    .order-card-date {
      font-size: 0.75rem;
      color: var(--color-text-tertiary);
    }

    .order-card-status {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .order-card-status--active {
      background: #dbeafe;
      color: #1d4ed8;
    }

    .order-card-status--completed {
      background: #d1fae5;
      color: #059669;
    }

    .order-card-status--cancelled {
      background: #fee2e2;
      color: #dc2626;
    }

    .order-card-items {
      font-size: 0.875rem;
      color: var(--color-text-secondary);
      margin-bottom: 0.5rem;
    }

    .order-card-total {
      font-size: 1.125rem;
      font-weight: 700;
      color: var(--color-primary);
    }

    .order-card-empty {
      text-align: center;
      padding: 2rem;
      color: var(--color-text-secondary);
    }

    /* Category Tabs - Redesign */
    .category-tabs {
      display: flex;
      gap: var(--space-2);
      padding: var(--space-3);
      overflow-x: auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
      background: white;
      border-radius: 12px;
      margin-bottom: var(--space-4);
      box-shadow: var(--shadow-sm);
    }

    .category-tabs::-webkit-scrollbar {
      display: none;
    }

    .category-tab {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-3) var(--space-4);
      background: var(--surface);
      border: 2px solid transparent;
      border-radius: 10px;
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-medium);
      color: var(--text-secondary);
      white-space: nowrap;
      cursor: pointer;
      transition: all 0.2s;
    }

    .category-tab:hover {
      background: var(--color-primary-light);
      color: var(--color-primary);
    }

    .category-tab.active {
      background: linear-gradient(135deg, var(--color-primary), #ff8c42);
      color: white;
      border-color: transparent;
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
    }

    .category-tab .category-icon {
      font-size: 1.25rem;
    }

    /* Product Cards - Premium Redesign */
    .menu-item-card {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: var(--shadow-md);
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
    }

    .menu-item-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
    }

    .menu-item-image-container {
      position: relative;
      width: 100%;
      height: 200px;
      overflow: hidden;
    }

    .menu-item-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .menu-item-card:hover .menu-item-image {
      transform: scale(1.05);
    }

    .menu-item-image-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 80px;
      background: linear-gradient(to top, rgba(255, 255, 255, 0.9), transparent);
      pointer-events: none;
    }

    .menu-item-badge {
      position: absolute;
      top: 8px;
      right: 8px;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
      backdrop-filter: blur(4px);
      z-index: 2;
    }

    .menu-item-badge--recommended {
      background: rgba(255, 215, 0, 0.9);
      color: #92400e;
    }

    .menu-item-badge--popular {
      background: rgba(239, 68, 68, 0.9);
      color: white;
    }

    .menu-item-badge--fast {
      background: rgba(34, 197, 94, 0.9);
      color: white;
    }

    .menu-item-badge--promo {
      background: rgba(255, 107, 53, 0.9);
      color: white;
    }

    .menu-item-badge--healthy {
      background: rgba(34, 197, 94, 0.9);
      color: white;
    }

    .menu-item-badge--soldout {
      background: rgba(107, 114, 128, 0.9);
      color: white;
    }

    .menu-item-content {
      padding: var(--space-4);
    }

    .menu-item-name {
      font-size: 1.125rem;
      font-weight: 700;
      color: var(--color-text-primary);
      margin: 0 0 var(--space-2) 0;
      line-height: 1.3;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .menu-item-description {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin: 0 0 var(--space-3) 0;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .menu-item-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--space-3);
    }

    .menu-item-price {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--color-primary);
      display: flex;
      align-items: center;
      gap: 2px;
    }

    .menu-item-price .currency {
      font-size: 0.875rem;
      font-weight: 600;
    }

    .menu-item-add-btn {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
      padding: 12px 16px;
      background: linear-gradient(135deg, var(--color-primary), #ff8c42);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .menu-item-add-btn:hover {
      background: var(--color-primary-hover);
      transform: scale(1.02);
    }

    .menu-item-add-btn:active {
      transform: scale(0.98);
    }

    .menu-item-add-btn.soldout {
      background: var(--color-surface);
      color: var(--text-tertiary);
      cursor: not-allowed;
    }

    .menu-item-add-btn.soldout:hover {
      transform: none;
    }

    /* Search Input - Redesign */
    .menu-search-container {
      position: relative;
      margin-bottom: var(--space-4);
    }

    .menu-search {
      width: 100%;
      height: 48px;
      padding: 0 var(--space-4) 0 48px;
      font-size: 1rem;
      border: 2px solid var(--color-border);
      border-radius: 12px;
      transition: all 0.2s;
    }

    .menu-search:focus-visible {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 0 4px rgba(255, 107, 53, 0.15);
    }

    .menu-search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-tertiary);
      pointer-events: none;
    }

    .menu-search-icon svg {
      width: 20px;
      height: 20px;
    }

    /* Menu Grid - Responsive */
    .menu-grid {
      display: grid;
      gap: var(--space-6);
    }

    @media (min-width: 375px) {
      .menu-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (min-width: 768px) {
      .menu-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (min-width: 1280px) {
      .menu-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (min-width: 1920px) {
      .menu-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    /* Filter Chips */
    .filter-chip {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-3) var(--space-4);
      background: var(--surface);
      border: 2px solid var(--color-border);
      border-radius: 10px;
      font-size: var(--font-size-sm);
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s;
    }

    .filter-chip:hover {
      border-color: var(--color-primary);
      color: var(--color-primary);
    }

    .filter-chip.active {
      background: var(--color-primary-light);
      border-color: var(--color-primary);
      color: var(--color-primary);
    }

    .filter-chip .filter-count {
      font-size: 0.75rem;
      padding: 2px 6px;
      background: var(--color-border);
      border-radius: 10px;
      color: var(--text-secondary);
    }

    .filter-chip.active .filter-count {
      background: var(--color-primary);
      color: white;
    }
    }

    .profile-menu-item:hover {
      border-color: var(--primary);
      background: var(--background);
    }

    .profile-menu-item span:first-child {
      font-size: 1.5rem;
    }

    .phone-input-container {
      display: flex;
      gap: 0.5rem;
    }

    .country-code-selector {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem;
      border: 2px solid var(--border);
      border-radius: 10px;
      background: var(--background);
      font-weight: 600;
      color: var(--text);
      min-width: 90px;
      justify-content: center;
    }

    .flag-icon {
      font-size: 1.5rem;
    }

    .country-code {
      font-size: 1rem;
    }

    .phone-input-container input[type='tel'] {
      flex: 1;
    }

    /* Keyboard Shortcuts Modal */
    .shortcuts-modal {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.6);
      backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      z-index: 10050;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
    }

    .shortcuts-modal.active {
      opacity: 1;
      pointer-events: auto;
    }

    .shortcuts-modal-content {
      background: white;
      border-radius: 16px;
      padding: 2rem;
      max-width: 500px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
      animation: shortcutsSlideUp 0.3s ease;
    }

    @keyframes shortcutsSlideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .shortcuts-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid var(--border);
    }

    .shortcuts-header h2 {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text);
      margin: 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .shortcuts-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--muted);
      cursor: pointer;
      padding: 0.25rem;
      line-height: 1;
      border-radius: 6px;
      transition: all 0.2s;
    }

    .shortcuts-close:hover {
      background: var(--background);
      color: var(--text);
    }

    .shortcuts-section {
      margin-bottom: 1.5rem;
    }

    .shortcuts-section:last-child {
      margin-bottom: 0;
    }

    .shortcuts-section h3 {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--muted);
      margin: 0 0 0.75rem 0;
    }

    .shortcuts-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .shortcut-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.625rem 0.875rem;
      background: var(--background);
      border-radius: 8px;
    }

    .shortcut-description {
      font-size: 0.9rem;
      color: var(--text);
    }

    .shortcut-keys {
      display: flex;
      gap: 0.375rem;
    }

    .shortcut-key {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 32px;
      height: 28px;
      padding: 0 0.5rem;
      background: white;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text);
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    }

    .shortcuts-hint {
      text-align: center;
      margin-top: 1.5rem;
      padding-top: 1rem;
      border-top: 1px solid var(--border);
      font-size: 0.85rem;
      color: var(--muted);
    }

    .shortcuts-hint kbd {
      display: inline-block;
      padding: 0.2rem 0.5rem;
      background: var(--background);
      border: 1px solid var(--border);
      border-radius: 4px;
      font-family: inherit;
      font-size: 0.8rem;
    }

    /* Shortcuts indicator */
    .shortcuts-indicator {
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.625rem 1rem;
      background: white;
      border-radius: 50px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text);
      cursor: pointer;
      transition: all 0.2s ease;
      z-index: 900;
    }

    .shortcuts-indicator:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
    }

    .shortcuts-indicator kbd {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 24px;
      height: 24px;
      padding: 0 0.375rem;
      background: var(--background);
      border: 1px solid var(--border);
      border-radius: 6px;
      font-family: inherit;
      font-size: 0.75rem;
      font-weight: 600;
    }

    @media (max-width: 640px) {
      .shortcuts-modal-content {
        padding: 1.5rem;
        max-height: 90vh;
      }

      .shortcuts-indicator {
        bottom: 1rem;
        right: 1rem;
        padding: 0.5rem 0.75rem;
        font-size: 0.8rem;
      }
    }

    /* Profile Modal Styles - FORCED LOCATION */
    .profile-modal {
      display: none !important;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 2000;
      animation: fadeIn 0.2s ease;
    }

    .profile-modal.active {
      display: flex !important;
      align-items: center;
      justify-content: center;
    }

    .profile-modal-overlay {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
    }

    .profile-modal-content {
      position: relative;
      background: white;
      max-width: 480px;
      width: 90%;
      border-radius: 16px;
      padding: 0;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.3s ease;
      overflow: hidden;
    }

    .profile-modal-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      width: 36px;
      height: 36px;
      background: var(--surface);
      border: none;
      border-radius: 50%;
      font-size: 1.5rem;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s;
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .profile-modal-close:hover {
      background: var(--border);
      color: var(--text);
    }
  </style>

  <style>
    /* FORCE STICKY HELPER STYLES - INLINE TO EVADE CACHE */
    .sticky-cart-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #ffffff !important;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
      padding: 1rem;
      z-index: 9000;
      transform: translateY(110%);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border-top: 1px solid #e5e7eb;
      display: block !important;
      visibility: visible;
    }

    .sticky-cart-bar--visible {
      transform: translateY(0) !important;
    }

    .sticky-cart-bar__content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .sticky-cart-bar__info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .sticky-cart-bar__icon {
      position: relative;
      width: 40px;
      height: 40px;
      background: #f3f4f6;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #4b5563;
    }

    .sticky-cart-bar__icon svg {
      width: 20px !important;
      height: 20px !important;
    }

    .sticky-cart-bar__badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #ef4444;
      color: white;
      font-size: 0.7rem;
      font-weight: 700;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .sticky-cart-bar__details {
      display: flex;
      flex-direction: column;
    }

    .sticky-cart-bar__label {
      font-size: 0.75rem;
      color: #6b7280;
      text-transform: uppercase;
      font-weight: 600;
    }

    .sticky-cart-bar__total {
      font-weight: 800;
      font-size: 1.1rem;
      color: #111827;
    }

    .sticky-cart-bar__items {
      font-size: 0.8rem;
      color: #6b7280;
    }

    .sticky-cart-bar__btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: linear-gradient(135deg, #f97316 0%, #fb923c 100%) !important;
      color: white !important;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 999px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
      transition: all 0.2s ease;
    }

    .sticky-cart-bar__btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(249, 115, 22, 0.4);
    }

    .sticky-cart-bar__btn svg {
      width: 1.25rem !important;
      height: 1.25rem !important;
      max-width: 20px !important;
    }

    /* UNDO SNACKBAR - INLINE FIX */
    .undo-snackbar {
      position: fixed;
      bottom: 90px;
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      background: #1f2937 !important;
      color: white !important;
      padding: 0.75rem 1.5rem;
      border-radius: 99px;
      display: flex;
      align-items: center;
      gap: 1rem;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      z-index: 9010;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .undo-snackbar.undo-snackbar--visible {
      opacity: 1 !important;
      pointer-events: auto !important;
      transform: translateX(-50%) translateY(0) !important;
      display: flex !important;
    }

    .undo-snackbar__action {
      background: transparent !important;
      border: 1px solid rgba(255, 255, 255, 0.2) !important;
      color: #60a5fa !important;
      padding: 0.25rem 0.75rem;
      border-radius: 99px;
      font-size: 0.85rem;
      cursor: pointer;
      font-weight: 600;
      margin-left: 0.5rem;
    }

    .undo-snackbar__action:hover {
      background: rgba(255, 255, 255, 0.1) !important;
    }
  </style>

  <!-- Keyboard Shortcuts Modal -->
  <div class="shortcuts-modal" id="shortcuts-modal" role="dialog" aria-labelledby="shortcuts-title" aria-modal="true">
    <div class="shortcuts-modal-content">
      <div class="shortcuts-header">
        <h2 id="shortcuts-title">
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122" />
          </svg>
          Atajos de Teclado
        </h2>
        <button class="shortcuts-close" aria-label="Cerrar atajos">&times;</button>
      </div>

      <div class="shortcuts-section">
        <h3>Navegaci√≥n</h3>
        <div class="shortcuts-list">
          <div class="shortcut-item">
            <span class="shortcut-description">Ir al inicio</span>
            <div class="shortcut-keys">
              <kbd>G</kbd>
              <kbd>H</kbd>
            </div>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-description">Enfocar b√∫squeda</span>
            <div class="shortcut-keys">
              <kbd>/</kbd>
            </div>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-description">Ver filtros</span>
            <div class="shortcut-keys">
              <kbd>F</kbd>
            </div>
          </div>
        </div>
      </div>

      <div class="shortcuts-section">
        <h3>Carrito y Pedidos</h3>
        <div class="shortcuts-list">
          <div class="shortcut-item">
            <span class="shortcut-description">Ver carrito</span>
            <div class="shortcut-keys">
              <kbd>C</kbd>
            </div>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-description">Confirmar pedido</span>
            <div class="shortcut-keys">
              <kbd>Enter</kbd>
            </div>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-description">Ver estado del pedido</span>
            <div class="shortcut-keys">
              <kbd>O</kbd>
            </div>
          </div>
        </div>
      </div>

      <div class="shortcuts-section">
        <h3>Men√∫</h3>
        <div class="shortcuts-list">
          <div class="shortcut-item">
            <span class="shortcut-description">Refrescar men√∫</span>
            <div class="shortcut-keys">
              <kbd>R</kbd>
            </div>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-description">Navegar productos</span>
            <div class="shortcut-keys">
              <kbd>J</kbd>
              <kbd>K</kbd>
            </div>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-description">Seleccionar categor√≠a</span>
            <div class="shortcut-keys">
              <kbd>1</kbd>
              <kbd>4</kbd>
            </div>
          </div>
        </div>
      </div>

      <div class="shortcuts-section">
        <h3>General</h3>
        <div class="shortcuts-list">
          <div class="shortcut-item">
            <span class="shortcut-description">Cerrar modal / Volver</span>
            <div class="shortcut-keys">
              <kbd>Esc</kbd>
            </div>
          </div>
        </div>
      </div>

      <p class="shortcuts-hint">Presiona <kbd>?</kbd> para mostrar esta ayuda</p>
    </div>
  </div>

  <!-- Shortcuts Hint Text -->
  <div class="shortcuts-hint-text" style="
        position: fixed;
        bottom: 0.5rem;
        right: 0.5rem;
        font-size: 0.7rem;
        color: #9ca3af;
        z-index: 800;
        pointer-events: none;
        opacity: 0.7;
      ">
    Presiona <kbd style="font-family: inherit; font-weight: bold">?</kbd> para atajos
  </div>

  <script>
    (function () {
      const modal = document.getElementById('shortcuts-modal');
      const closeBtn = modal?.querySelector('.shortcuts-close');

      function openModal() {
        modal?.classList.add('active');
        closeBtn?.focus();
      }

      function closeModal() {
        modal?.classList.remove('active');
      }

      closeBtn?.addEventListener('click', closeModal);

      // Close on backdrop click
      modal?.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
      });

      document.addEventListener('keydown', function (e) {
        // Robust key check for ? (Shift+/)
        const isQuestionMark = e.key === '?' || (e.key === '/' && e.shiftKey);

        if (isQuestionMark && !e.target.matches('input, textarea, select')) {
          e.preventDefault();
          if (modal?.classList.contains('active')) {
            closeModal();
          } else {
            openModal();
          }
        }

        if (e.key === 'Escape' && modal?.classList.contains('active')) {
          closeModal();
        }
      });
    })();
  </script>

  <script>
    window.__PRONTO_TS_CLIENT_BASE__ = true;
  </script>
  <script type="module" src="{{ static_host_url }}/assets/js/clients/base.js?v=cachebust1"></script>

  <!-- Sticky Cart Summary Bar (Mobile) -->
  <div class="sticky-cart-bar" id="sticky-cart-bar" role="dialog" aria-label="Resumen del carrito">
    <div class="sticky-cart-bar__content">
      <div class="sticky-cart-bar__info">
        <div class="sticky-cart-bar__icon">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
          </svg>
          <span class="sticky-cart-bar__badge" id="sticky-cart-count">0</span>
        </div>
        <div class="sticky-cart-bar__details">
          <span class="sticky-cart-bar__label">Tu pedido:</span>
          <span class="sticky-cart-bar__total" id="sticky-cart-total">$0.00</span>
          <span class="sticky-cart-bar__items" id="sticky-cart-items">0 art√≠culos</span>
        </div>
      </div>
      <button class="sticky-cart-bar__btn" id="sticky-cart-btn" onclick="showCart()">
        Ver Carrito
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Undo Snackbar -->
  <div class="undo-snackbar" id="undo-snackbar" role="alert" aria-live="polite">
    <span class="undo-snackbar__message">Art√≠culo eliminado</span>
    <button class="undo-snackbar__action" id="undo-btn">Deshacer</button>
  </div>

  <!-- Debug Panel -->
  {# {% if debug_auto_table %} {% include 'debug_panel.html'} {% endif %} #}

  <!-- Force hide broken modals -->
  <script>
    // Hide broken modals that appear empty in the footer
    (function () {
      const hideModals = () => {
        const selectors = [
          '#keyboard-shortcuts-modal',
          '#shortcuts-modal',
          '#business-hours-modal',
          '#business-hours-display',
          '.shortcuts-modal',
          '.business-hours-display',
          '.business-hours-title',
        ];

        selectors.forEach((selector) => {
          const elements = document.querySelectorAll(selector);
          elements.forEach((el) => {
            if (el) {
              el.style.setProperty('display', 'none', 'important');
              el.style.setProperty('visibility', 'hidden', 'important');
              el.style.setProperty('opacity', '0', 'important');
              el.style.setProperty('pointer-events', 'none', 'important');
              el.style.setProperty('height', '0', 'important');
              el.style.setProperty('overflow', 'hidden', 'important');
            }
          });
        });
      };

      // Run immediately
      hideModals();

      // Run after DOM is fully loaded
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', hideModals);
      }

      // Run after a short delay to catch dynamically added elements
      setTimeout(hideModals, 500);
      setTimeout(hideModals, 1000);
      setTimeout(hideModals, 2000);
    })();
  </script>

  {% block scripts %}{% endblock %}
  <script>
    // FORCE CONFIG RESTORATION - FIX FOR LEGACY OVERWRITE
    (function () {
      if (!window.APP_CONFIG) window.APP_CONFIG = {};

      // Restore values that might have been lost
      if (!window.APP_CONFIG.static_host_url) {
        window.APP_CONFIG.static_host_url = '{{ static_host_url }}';
      }

      // Ensure restaurant assets are correct
      if (!window.APP_CONFIG.restaurant_assets || window.APP_CONFIG.restaurant_assets.includes('undefined')) {
        window.APP_CONFIG.restaurant_assets = '{{ restaurant_assets }}';
      }

      console.log('[Config Fixer] Restored APP_CONFIG:', window.APP_CONFIG);
    })();

    document.addEventListener('DOMContentLoaded', () => {
      if (window.Lucide && window.Lucide.createIcons) {
        window.Lucide.createIcons({ icons: window.Lucide.icons });
      }
    });
  </script>
</body>

</html>